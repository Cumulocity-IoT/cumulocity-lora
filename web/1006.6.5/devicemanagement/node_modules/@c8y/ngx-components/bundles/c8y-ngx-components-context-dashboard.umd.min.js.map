{"version":3,"sources":["../../../../node_modules/tslib/tslib.es6.js","ng://@c8y/ngx-components/context-dashboard/context-dashboard.model.ts","ng://@c8y/ngx-components/context-dashboard/context-dashboard.service.ts","ng://@c8y/ngx-components/context-dashboard/device-dashboard.guard.ts","ng://@c8y/ngx-components/context-dashboard/dashboard-detail.component.ts","ng://@c8y/ngx-components/context-dashboard/widget.service.ts","ng://@c8y/ngx-components/context-dashboard/widget-config.component.ts","ng://@c8y/ngx-components/context-dashboard/context-dashboard.component.ts","ng://@c8y/ngx-components/context-dashboard/group-dashboard.guard.ts","ng://@c8y/ngx-components/context-dashboard/dashboard-actions.factory.ts","ng://@c8y/ngx-components/context-dashboard/appearance-settings.component.ts","ng://@c8y/ngx-components/context-dashboard/widget-preview.component.ts","ng://@c8y/ngx-components/context-dashboard/context-dashboard.module.ts","ng://@c8y/ngx-components/context-dashboard/cockpit-dashboard.component.ts","ng://@c8y/ngx-components/context-dashboard/welcome/welcome.component.ts","ng://@c8y/ngx-components/context-dashboard/legacy-welcome/legacy-welcome.component.ts","ng://@c8y/ngx-components/context-dashboard/cockpit-dashboard.module.ts"],"names":["__assign","Object","assign","t","s","i","n","arguments","length","p","prototype","hasOwnProperty","call","apply","this","__decorate","decorators","target","key","desc","d","c","r","getOwnPropertyDescriptor","Reflect","decorate","defineProperty","__param","paramIndex","decorator","__awaiter","thisArg","_arguments","P","generator","Promise","resolve","reject","fulfilled","value","step","next","e","rejected","result","done","then","__generator","body","f","y","g","_","label","sent","trys","ops","verb","throw","return","Symbol","iterator","v","op","TypeError","pop","push","ContextDashboardType","CONTEXT_DASHBOARD_CONFIG","InjectionToken","WIDGET_HEADER_CLASSES","gettext","class","description","WIDGET_CONTENT_CLASSES","DASHBOARD_THEME_CLASSES","ContextDashboardService","inventory","tabs","modal","translateService","router","user","appState","cache","Map","DEFAULT_PAGESIZE","FRAGMENT_NAME","DASHBOARD_ROUTE_PATH","INDEX_SPLIT","_formDisabled","create","dashboardCfg","contextOrName","id","dashboardType","Named","contextData","getDashboardTypeFromViewContext","dashboard","c8y_Dashboard","DeviceType","deviceTypeValue","fragmentKey","createFragmentKey","shouldSetGlobal","c8y_Global","Group","Device","childAdditionsCreate","_a","_b","data","detail","dashboardMO","set","update","cleanedDashboard","clean","pick","delete","msg","isDeviceType","confirm","instant","dashboardName","name","deviceType","Status","DANGER","ok","cancel","tabToRemove","Array","from","state","find","tab","path","endsWith","_this","remove","refresh","activateDashboards","route","types","dashboardId","params","getDashboard$","parent","pipe","tap","map","catchError","of","getTabs$","getNamedDashboardOrCreate","defaultWidgets","children","mapWidgets","throwIfEmpty","refreshTabs","isNamed","tabToUpdate","addTab","icon","priority","name_1","add","currentContextRoute","navigateToDashboard","test","url","navigate","relativeTo","getActivatedRoute","hasPermission","hasAnyRole","currentUser","some","keys","prop","RegExp","getStyling","styleList","styleName","defaultValue","styling","style","widgets","keyBy","widget","String","Math","random","substr","dashboardIdOrName","mo","get","dashboards","getContextDashboards","getNamedDashboard","cacheRefresh","cacheDashboards","filter","has","setBaseContextRoute","toArray","requests","mergeAll","mergeMap","response","type","includes","jsonString","JSON","stringify","parse","list","fragmentType","pageSize","context","ViewContext","contextDashboardType","join","InventoryService","TabsService","ModalService","TranslateService","Router","UserService","AppStateService","Injectable","DeviceDashboardGuard","contextDashboardService","canActivate","DashboardDetailComponent","iconList","themeClass","headerClass","possibleStyling","_save","_cancel","DEFAULT_DASHBOARD_MARGIN","DEFAULT_DASHBOARD_ICON","DEFAULT_DASHBOARD_PRIORITY","DEFAULT_DASHBOARD_NAME","icons","filteredIcons","ngAfterContentInit","defaultDashboardCfg","current","clone","setDashboardStyle","dashboardDetailForm","form","markAsDirty","save","classes","widgetClasses","close","hide","getDashboardPreviewStyle","cssClasses","selectIcon","updateFiltered","term","search_1","val","allClasses","split","forEach","BsModalRef","Inject","args","ICON_LIST","tslib_1.__decorate","ViewChild","static","Component","selector","template","tslib_1.__param","WidgetService","dynamicComponentService","moduleConfig","getWidgetDefinition","componentId","getById$","toPromise","getWidgetDefinitions","translatedComponents","cmp","cloneDeep","sortBy","widgetFilter","DynamicComponentService","providedIn","WidgetConfigComponent","widgetService","mode","searchChange$","Subject","searchTerm","contentClass","defaultStyling","isUpgrade","components","selected","select","isEdit","searchSub","switchMap","event","iif","which","timer","subscribe","search","setDefaultStyle","_x","_y","_width","_height","widgetConfig","device","tslib_1.__assign","config","omit","title","getStyle","settings","widgetDefaults","formDisabled","composeWidgetConfig","componentLabel","searchResult","escapeRegExp","trim","resetSearch","undefined","changeMode","isPreview","isDashboardDefaultStyle","ngOnDestroy","unsubscribe","className","styles","cssClass","setClasses","selectedComponent","setting","dashboardMo","applyTargetIfDeviceDashboard","hideTarget","ng1","options","noDeviceTarget","ContextDashboardComponent","alert","renderer","bsModal","childrenClasses","setTitle","disabled","canDelete","isLoading","ngOnInit","loadNamedDashboard","loadContextDashboard","applyDeviceTarget","dataSub","restore","onLoad","updateDashboardChildren","child","mappedChildren","componentToWidget","deleteDashboard","snapshot","segment","navigateByUrl","editDashboard","initialState","isNamedDashboard","show","ignoreBackdropClick","content","editWidget","change","source","x","width","height","component","addWidget","newWidget","mergeWidgetClasses","updateWidget","index","findIndex","isNew","mapLegacy","mappedWidget","splice","deleteWidget","removed","indexOf","setTimeout","DashboardChildChange","collapseUpAll","addDashboardClassToBody","addClass","document","removeDashboardClassFromBody","removeClass","toggleFreeze","toggleIsFrozenFlag","isFrozen","success","addServerFailure","ex_3","dashboardChildren","dashboardClasses","c8y-grid-dashboard","all","values","el","card","card-dashboard","widgetComponent","configComponent","templateUrl","configTemplateUrl","transformConfigWithContext","componentTransformConfigWithContext","ActivatedRoute","AlertService","Renderer2","BsModalService","Input","HostBinding","host","GroupDashboardGuard","DashboardActionsFactory","activatedRoute","action","addDashboard","isEnabled","AppearanceSettingsComponent","themeClassChange","EventEmitter","headerClassChange","possibleStylingTheme","possibleStylingHeader","themeClassClick","resetToDefault","defaultThemeClass","emit","headerClassClick","defaultHeaderClass","compareTo","Output","viewProviders","provide","ControlContainer","useExisting","NgForm","WidgetPreviewComponent","previewClasses","dashboard-theme-light","panel-title-regular","defaultConfig","allowFullscreen","noNewWidgets","routes","ContextDashboardModule","ngModule","ContextDashboardModule_1","providers","useValue","HOOK_ONCE_ROUTE","multi","HOOK_ACTION","useClass","NgModule","declarations","imports","CoreModule","TooltipModule","PopoverModule","BsDropdownModule","forRoot","exports","entryComponents","CockpitDashboardComponent","DEFAULT_HOME_WIDGETS","panel-title-hidden","WelcomeToCockpit","tenantService","docs","navigator","applicationService","quickLinks","REPORT_NODE","CONFIGURATION_NODE","TRIAL","currentTenantType","tenantType","setMessage","navSubscription","items$","nodes","navNodes","docsSubscription","links","createConnectSmartphoneQuickLink","createQuicklinkRegisterDevice","createQuicklinkUserGuide","createQuicklinkAddGroup","createQuickLinkReports","createQuicklinkDataPointLibrary","createQuicklinkSmartRules","closed","welcomeMessage","addGroup","link","connectSmartphone","reports","reportsNode","findNavigatorNode","click","open","dataPointLib","configurationNode","smartRules","listByUser","deviceManagement","app","contextPath","deviceMgmtUrl_1","getHref","registerDevice","window","userGuide","userGuideURL","getUserGuideLink","nodeRealName","node","realName","TenantService","DocsService","NavigatorService","ApplicationService","LegacyWelcomeComponent","Host","previewImage","require","ex","ɵ1","groupsSelectable","ɵ2","CockpitDashboardModule","DocsModule","QuickLinkModule","TranslateModule","HOOK_NAVIGATOR_NODES","ɵ0","HOOK_COMPONENTS"],"mappings":"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","sourcesContent":["/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation. All rights reserved.\r\nLicensed under the Apache License, Version 2.0 (the \"License\"); you may not use\r\nthis file except in compliance with the License. You may obtain a copy of the\r\nLicense at http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nTHIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED\r\nWARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,\r\nMERCHANTABLITY OR NON-INFRINGEMENT.\r\n\r\nSee the Apache Version 2.0 License for specific language governing permissions\r\nand limitations under the License.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport function __exportStar(m, exports) {\r\n    for (var p in m) if (!exports.hasOwnProperty(p)) exports[p] = m[p];\r\n}\r\n\r\nexport function __values(o) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator], i = 0;\r\n    if (m) return m.call(o);\r\n    return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n};\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\r\n    result.default = mod;\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n","import { InjectionToken } from '@angular/core';\nimport { IManagedObject } from '@c8y/client';\nimport { Widget, DynamicComponentDefinition, Route, gettext } from '@c8y/ngx-components';\n\nexport const CONTEXT_DASHBOARD_CONFIG = new InjectionToken<any>('ContextDashboardConfig');\n\nexport interface ContextDashboardConfig {\n  widgetFilter?: (component: DynamicComponentDefinition) => boolean;\n  allowFullscreen?: boolean;\n  routes?: Route[];\n}\n\nexport interface ContextWidgetConfig {\n  /**\n   * Settings that define how the default config component is\n   * displayed.\n   */\n  settings?: {\n    /**\n     * Avoids to show the widget in the \"add widget\" modal\n     */\n    noNewWidgets?: boolean;\n    ng1?: {\n      options: {\n        /**\n         * Set this to false, to hide the device/group selector\n         * @deprecated: This is currently only implemented in angularjs and will be exported to a separate component.\n         */\n        noDeviceTarget?: boolean;\n        /**\n         * Set this to false to only select devices\n         * @deprecated: This is currently only implemented in angularjs and will be exported to a separate component.\n         */\n        groupsSelectable?: boolean;\n      };\n      /**\n       * The context from the device selector.\n       */\n      context?: {\n        id?: string;\n        name?: string;\n      };\n    };\n    /**\n     * Any other information you want to pass to the config template\n     */\n    [key: string]: any;\n  };\n  /**\n   * The selected device or group (note: naming is inconsistent as group was added later\n   * but must stay for already implemented widgets)\n   */\n  device?: {\n    id?: string;\n    name?: string;\n  };\n  /**\n   * Any other information that should be stored here.\n   */\n  [key: string]: any;\n}\n\nexport interface ContextDashboardManagedObject extends IManagedObject {\n  c8y_Dashboard?: ContextDashboard;\n}\n\nexport interface ContextDashboard {\n  icon?: string;\n  name?: string;\n  priority?: number;\n  deviceType?: boolean;\n  deviceTypeValue?: string;\n  isFrozen?: boolean;\n  classes?: { [key: string]: boolean };\n  widgetClasses?: { [key: string]: boolean };\n  widgetMargin?: number;\n  translateWidgetTitle?: boolean;\n  global?: boolean;\n  children?: {\n    [id: string]: Widget;\n  };\n}\n\nexport enum ContextDashboardType {\n  Device = 'device',\n  DeviceType = 'type',\n  Group = 'group',\n  Named = 'name'\n}\n\nexport const WIDGET_HEADER_CLASSES = [\n  {\n    label: gettext('Regular`style`'),\n    class: 'panel-title-regular',\n    description: gettext('The widget has no border between header and content.')\n  },\n  {\n    label: gettext('Border`style`'),\n    class: 'panel-title-border',\n    description: gettext('The widget has a small separation border between header and content.')\n  },\n  {\n    label: gettext('Overlay`style`'),\n    class: 'panel-title-overlay',\n    description: gettext('The widget content overlays the header.')\n  },\n  {\n    label: gettext('Hidden`style`'),\n    class: 'panel-title-hidden',\n    description: gettext('The widget header is not shown.')\n  }\n];\n\nexport const WIDGET_CONTENT_CLASSES = [\n  {\n    label: gettext('Light`style`'),\n    class: 'panel-content-light',\n    description: gettext('The widget is styled with a light background and has low contrast.')\n  },\n  {\n    label: gettext('Dark`style`'),\n    class: 'panel-content-dark',\n    description: gettext('The widget is styled with a dark background and has high contrast.')\n  },\n  {\n    label: gettext('Transparent`style`'),\n    class: 'panel-content-transparent',\n    description: gettext(\n      'The widget is styled with a transparent background and therefore is border-less.'\n    )\n  },\n  {\n    label: gettext('Branded`style`'),\n    class: 'panel-content-branded',\n    description: gettext('The widget is styled with the main brand color.')\n  }\n];\n\nexport const DASHBOARD_THEME_CLASSES = [\n  {\n    label: gettext('Light`theme`'),\n    class: 'dashboard-theme-light',\n    description: gettext('The dashboard is styled with a light background and has low contrast.')\n  },\n  {\n    label: gettext('Dark`theme`'),\n    class: 'dashboard-theme-dark',\n    description: gettext('The dashboard is styled with a dark background and has high contrast.')\n  },\n  {\n    label: gettext('Transparent`theme`'),\n    class: 'dashboard-theme-transparent',\n    description: gettext(\n      'The dashboard is styled with a transparent background and therefore is border-less.'\n    )\n  },\n  {\n    label: gettext('Branded`theme`'),\n    class: 'dashboard-theme-branded',\n    description: gettext('The dashboard is styled with the main brand color.')\n  }\n];\n","import { Injectable } from '@angular/core';\nimport { ActivatedRouteSnapshot, Router } from '@angular/router';\nimport { IManagedObject, InventoryService, IResultList, UserService } from '@c8y/client';\nimport {\n  AppStateService,\n  getActivatedRoute,\n  gettext,\n  ModalService,\n  Status,\n  TabsService,\n  ViewContext,\n  Widget\n} from '@c8y/ngx-components';\nimport { TranslateService } from '@ngx-translate/core';\nimport { assign, pick, some, keys, keyBy, has } from 'lodash-es';\nimport { from, of } from 'rxjs';\nimport {\n  catchError,\n  filter,\n  map,\n  mergeAll,\n  mergeMap,\n  tap,\n  toArray,\n  throwIfEmpty\n} from 'rxjs/operators';\nimport {\n  ContextDashboard,\n  ContextDashboardManagedObject,\n  ContextDashboardType\n} from './context-dashboard.model';\n\n@Injectable()\nexport class ContextDashboardService {\n  private cache = new Map<string, ContextDashboardManagedObject>();\n  private readonly DEFAULT_PAGESIZE = 1000;\n  private readonly FRAGMENT_NAME = 'c8y_Dashboard';\n  private readonly DASHBOARD_ROUTE_PATH = 'dashboard';\n  private readonly INDEX_SPLIT = '!';\n  private currentContextRoute: string;\n  private _formDisabled = true;\n\n  get formDisabled() {\n    return this._formDisabled;\n  }\n\n  set formDisabled(value) {\n    this._formDisabled = value;\n  }\n\n  constructor(\n    private inventory: InventoryService,\n    private tabs: TabsService,\n    private modal: ModalService,\n    private translateService: TranslateService,\n    private router: Router,\n    private user: UserService,\n    private appState: AppStateService\n  ) {}\n\n  async create(dashboardCfg: ContextDashboard, contextOrName: { contextData: any } | string) {\n    let id;\n    let dashboardType;\n    if (typeof contextOrName === 'string') {\n      id = contextOrName as string;\n      dashboardType = ContextDashboardType.Named;\n    } else {\n      id = contextOrName.contextData.id as string;\n      dashboardType = this.getDashboardTypeFromViewContext(dashboardCfg, contextOrName);\n    }\n\n    const dashboard: Partial<IManagedObject> = {};\n    assign(dashboard, { c8y_Dashboard: dashboardCfg });\n\n    const value =\n      dashboardType === ContextDashboardType.DeviceType ? dashboardCfg.deviceTypeValue : id;\n\n    const fragmentKey = this.createFragmentKey(dashboardType, value);\n    dashboard[fragmentKey] = {};\n\n    if (this.shouldSetGlobal(dashboard)) {\n      assign(dashboard, { c8y_Global: {} });\n    }\n    const { data } = dashboardType === ContextDashboardType.Group || dashboardType === ContextDashboardType.Device\n      ? await this.inventory.childAdditionsCreate(dashboard, id)\n      : await this.inventory.create(dashboard);\n    return data as ContextDashboardManagedObject;\n  }\n\n  async detail(dashboardMO: ContextDashboardManagedObject) {\n    const { data } = await this.inventory.detail(dashboardMO);\n    this.cache.set(dashboardMO.id, data);\n    return data;\n  }\n\n  async update(dashboard: ContextDashboardManagedObject) {\n    const cleanedDashboard = this.clean(pick(dashboard, [this.FRAGMENT_NAME, 'id']));\n    cleanedDashboard.c8y_Global = this.shouldSetGlobal(dashboard);\n    const { data } = await this.inventory.update(cleanedDashboard);\n    this.cache.set(dashboard.id, data);\n    return data;\n  }\n\n  async delete(dashboard: ContextDashboardManagedObject) {\n    try {\n      let msg = gettext(\n        `You are about to delete the dashboard \"{{ dashboardName }}\". Do you want to proceed?`\n      );\n      if (this.isDeviceType(dashboard)) {\n        msg = gettext(\n          `You are about to delete the dashboard \"{{ dashboardName }}\" from all devices of the type \"{{ deviceType }}\".\n           Do you want to proceed?`\n        );\n      }\n      await this.modal.confirm(\n        gettext('Delete dashboard'),\n        this.translateService.instant(msg, {\n          dashboardName: dashboard.c8y_Dashboard.name,\n          deviceType: dashboard.c8y_Dashboard.deviceTypeValue\n        }),\n        Status.DANGER,\n        {\n          ok: gettext('Delete'),\n          cancel: gettext('Cancel')\n        }\n      );\n      await this.inventory.delete(dashboard);\n      const tabToRemove = Array.from(this.tabs.state).find(tab =>\n        tab.path.endsWith(`${this.DASHBOARD_ROUTE_PATH}/${dashboard.id}`)\n      );\n      this.tabs.remove(tabToRemove);\n      this.tabs.refresh();\n    } catch (ex) {\n      // intended empty\n    }\n  }\n\n  activateDashboards(route: ActivatedRouteSnapshot, types: ContextDashboardType[]) {\n    const { dashboardId } = route.params;\n    if (dashboardId) {\n      return this.getDashboard$(dashboardId, types, route.parent.data.contextData).pipe(\n        tap(dashboard => {\n          route.data = { dashboard };\n        }),\n        map(() => true),\n        catchError(() => {\n          return of(false);\n        })\n      );\n    }\n\n    return this.getTabs$(route.data.contextData, types);\n  }\n\n  getNamedDashboardOrCreate(name: string, defaultWidgets: Widget[]) {\n    const children = this.mapWidgets(defaultWidgets);\n    return this.getDashboard$(name, [ContextDashboardType.Named]).pipe(\n      throwIfEmpty(),\n      catchError(() =>\n        from(\n          this.create({children}, name)\n        )\n      )\n    );\n  }\n\n  async refreshTabs(dashboardMO: ContextDashboardManagedObject) {\n    if (!this.isNamed(dashboardMO)) {\n      const tabToUpdate = Array.from(this.tabs.state).find(tab =>\n        tab.path.endsWith(`${this.DASHBOARD_ROUTE_PATH}/${dashboardMO.id}`)\n      );\n\n      if (!tabToUpdate) {\n        this.addTab(dashboardMO);\n      } else {\n        const data = await this.detail(dashboardMO);\n        const { icon, priority, name } = data.c8y_Dashboard;\n        tabToUpdate.icon = icon;\n        tabToUpdate.priority = priority;\n        tabToUpdate.label = name;\n      }\n      this.tabs.refresh();\n    }\n  }\n\n  async addTab(dashboard: ContextDashboardManagedObject) {\n    const data = await this.detail(dashboard);\n    const { icon, priority, name } = data.c8y_Dashboard;\n\n    this.tabs.add({\n      icon,\n      priority,\n      label: name,\n      path: `${this.currentContextRoute}/${this.DASHBOARD_ROUTE_PATH}/${data.id}`\n    });\n  }\n\n  async navigateToDashboard(dashboardMO: ContextDashboardManagedObject) {\n    if (/dashboard/.test(this.router.url)) {\n      this.router.navigate(['..', dashboardMO.id], {\n        relativeTo: getActivatedRoute(this.router)\n      });\n    } else {\n      this.router.navigate(['..', 'dashboard', dashboardMO.id], {\n        relativeTo: getActivatedRoute(this.router)\n      });\n    }\n  }\n\n  hasPermission() {\n    return this.user.hasAnyRole(this.appState.currentUser.value, [\n      'ROLE_INVENTORY_ADMIN',\n      'ROLE_INVENTORY_CREATE'\n    ]);\n  }\n\n  isNamed(dashboard: Partial<ContextDashboardManagedObject>) {\n    return some(keys(dashboard), prop =>\n      new RegExp(\n        `^${this.FRAGMENT_NAME}${this.INDEX_SPLIT}${ContextDashboardType.Named}${this.INDEX_SPLIT}`\n      ).test(prop)\n    );\n  }\n\n  isDeviceType(dashboard: Partial<ContextDashboardManagedObject>) {\n    return some(keys(dashboard), prop =>\n      new RegExp(\n        `^${this.FRAGMENT_NAME}${this.INDEX_SPLIT}${ContextDashboardType.DeviceType}${\n          this.INDEX_SPLIT\n        }`\n      ).test(prop)\n    );\n  }\n\n  getStyling(styleList, styleName, defaultValue) {\n    const styling = styleList.find(style => style && new RegExp(styleName, 'i').test(style.class));\n    return styling ? styling.class : defaultValue;\n  }\n\n  mapWidgets(widgets: Widget[]) {\n    return keyBy(\n      widgets.map(widget => {\n        widget.id = String(Math.random()).substr(2);\n        return widget;\n      }),\n      'id'\n    );\n  }\n\n  private getDashboard$(\n    dashboardIdOrName,\n    dashboardType: ContextDashboardType[],\n    mo?: IManagedObject\n  ) {\n    const cache = this.cache.get(dashboardIdOrName);\n\n    const dashboards = mo\n      ? this.getContextDashboards(mo, dashboardType)\n      : [this.getNamedDashboard(dashboardIdOrName)];\n\n    const cacheRefresh = this.cacheDashboards(dashboards).pipe(\n      filter(\n        dashboard =>\n          dashboard.id === dashboardIdOrName ||\n          has(\n            dashboard,\n            `${this.FRAGMENT_NAME}${this.INDEX_SPLIT}${ContextDashboardType.Named}${\n              this.INDEX_SPLIT\n            }${dashboardIdOrName}`\n          )\n      )\n    );\n    return cache ? of(cache) : cacheRefresh;\n  }\n\n  private getTabs$(mo: ContextDashboardManagedObject, dashboardType: ContextDashboardType[]) {\n    this.setBaseContextRoute(mo, dashboardType);\n    return this.cacheDashboards(this.getContextDashboards(mo, dashboardType)).pipe(\n      map(({ c8y_Dashboard: dashboard, id }) => ({\n        icon: dashboard.icon,\n        path: `${this.DASHBOARD_ROUTE_PATH}/${id}`,\n        label: dashboard.name,\n        priority: dashboard.priority\n      })),\n      toArray()\n    );\n  }\n\n  private cacheDashboards(requests: Array<Promise<IResultList<IManagedObject>>>) {\n    return from(requests).pipe(\n      mergeAll(),\n      mergeMap(response => response.data as ContextDashboardManagedObject[]),\n      tap(dashboard => this.cache.set(dashboard.id, dashboard))\n    );\n  }\n\n  private setBaseContextRoute(mo: IManagedObject, dashboardType: ContextDashboardType[]) {\n    const type = dashboardType.includes(ContextDashboardType.Device)\n      ? ContextDashboardType.Device\n      : ContextDashboardType.Group;\n    this.currentContextRoute = `${type}/${mo.id}`;\n  }\n\n  private clean(dashboard) {\n    const jsonString = JSON.stringify(dashboard, (key, value) => {\n      if (key === '$$hashKey' || key === 'klasses') {\n        return undefined;\n      }\n\n      return value;\n    });\n    return JSON.parse(jsonString);\n  }\n\n  private getNamedDashboard(name: string) {\n    return this.inventory.list({\n      fragmentType: `${this.FRAGMENT_NAME}${this.INDEX_SPLIT}${ContextDashboardType.Named}${\n        this.INDEX_SPLIT\n      }${name}`,\n      pageSize: 1\n    });\n  }\n\n  private getContextDashboards(mo: IManagedObject, dashboardType: ContextDashboardType[]) {\n    return dashboardType.map((type: ContextDashboardType) =>\n      this.inventory.list({\n        fragmentType: `${this.FRAGMENT_NAME}${this.INDEX_SPLIT}${type}${this.INDEX_SPLIT}${\n          type === ContextDashboardType.DeviceType ? mo.type : mo.id\n        }`,\n        pageSize: this.DEFAULT_PAGESIZE\n      })\n    );\n  }\n\n  private getDashboardTypeFromViewContext(dashboardCfg, context) {\n    let dashboardType;\n    if (context.context === ViewContext.Device) {\n      dashboardType = dashboardCfg.deviceType\n        ? ContextDashboardType.DeviceType\n        : ContextDashboardType.Device;\n    }\n    if (context.context === ViewContext.Group) {\n      dashboardType = ContextDashboardType.Group;\n    }\n    return dashboardType;\n  }\n\n  private createFragmentKey(contextDashboardType: ContextDashboardType, value: string) {\n    return [this.FRAGMENT_NAME, contextDashboardType, value].join(this.INDEX_SPLIT);\n  }\n\n  private shouldSetGlobal(dashboard: Partial<ContextDashboardManagedObject>) {\n    if (this.isNamed(dashboard) || this.isDeviceType(dashboard)) {\n      return {};\n    }\n    return null;\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { ActivatedRouteSnapshot } from '@angular/router';\nimport { ContextDashboardType } from './context-dashboard.model';\nimport { ContextDashboardService } from './context-dashboard.service';\n\n@Injectable()\nexport class DeviceDashboardGuard {\n  constructor(\n    private contextDashboardService: ContextDashboardService\n  ) {}\n\n  canActivate(route: ActivatedRouteSnapshot) {\n    return this.contextDashboardService.activateDashboards(route, [\n      ContextDashboardType.Device,\n      ContextDashboardType.DeviceType\n    ]);\n  }\n}\n","import { Component, Inject, ViewChild } from '@angular/core';\nimport { ICON_LIST } from '@c8y/ngx-components';\nimport { BsModalRef } from 'ngx-bootstrap/modal';\nimport {\n  ContextDashboard,\n  DASHBOARD_THEME_CLASSES,\n  WIDGET_HEADER_CLASSES\n} from './context-dashboard.model';\nimport { clone } from 'lodash-es';\nimport { ContextDashboardService } from './context-dashboard.service';\nimport { NgForm } from '@angular/forms';\n\n@Component({\n  selector: 'c8y-dashboard-detail',\n  templateUrl: './dashboard-detail.component.html'\n})\nexport class DashboardDetailComponent {\n  @ViewChild('dashboardDetailForm', { static: true }) dashboardDetailForm: NgForm;\n  dashboard: ContextDashboard;\n  current: ContextDashboard;\n  deviceType: string;\n  isNamedDashboard: boolean;\n  icons: string[];\n  filteredIcons: string[];\n  styling = {\n    themeClass: 'dashboard-theme-light',\n    headerClass: 'panel-title-regular'\n  };\n  possibleStyling = { DASHBOARD_THEME_CLASSES, WIDGET_HEADER_CLASSES };\n  result: Promise<ContextDashboard> = new Promise((resolve, reject) => {\n    this._save = resolve;\n    this._cancel = reject;\n  });\n\n  readonly DEFAULT_DASHBOARD_MARGIN = 12;\n  readonly DEFAULT_DASHBOARD_ICON = 'th';\n  readonly DEFAULT_DASHBOARD_PRIORITY = 10000;\n  readonly DEFAULT_DASHBOARD_NAME = 'Dashboard';\n\n  private _save;\n  private _cancel;\n\n  constructor(\n    private modal: BsModalRef,\n    @Inject(ICON_LIST) iconList: string[],\n    private contextDashboardService: ContextDashboardService\n  ) {\n    this.icons = iconList;\n    this.filteredIcons = iconList;\n  }\n\n  ngAfterContentInit(): void {\n    const defaultDashboardCfg = {\n      name: this.DEFAULT_DASHBOARD_NAME,\n      priority: this.DEFAULT_DASHBOARD_PRIORITY,\n      icon: this.DEFAULT_DASHBOARD_ICON,\n      deviceTypeValue: this.deviceType\n    };\n\n    if (this.dashboard) {\n      this.current = clone(this.dashboard);\n      this.setDashboardStyle();\n    } else {\n      this.dashboard = defaultDashboardCfg;\n      this.dashboardDetailForm.form.markAsDirty();\n    }\n  }\n\n  save() {\n    this.dashboard.classes = { [this.styling.themeClass]: true };\n    this.dashboard.widgetClasses = { [this.styling.headerClass]: true };\n    this._save(this.dashboard);\n  }\n\n  close() {\n    this._cancel();\n    this.modal.hide();\n  }\n\n  getDashboardPreviewStyle() {\n    const cssClasses = {};\n    cssClasses[this.styling.headerClass] = true;\n    cssClasses[this.styling.themeClass] = true;\n    return cssClasses;\n  }\n\n  selectIcon(icon) {\n    this.dashboard.icon = icon;\n    this.dashboardDetailForm.form.markAsDirty();\n  }\n\n  updateFiltered(term: string) {\n    if (term) {\n      const search = new RegExp(term, 'i');\n      this.filteredIcons = this.icons.filter(val => search.test(val));\n    } else {\n      this.filteredIcons = this.icons;\n    }\n  }\n\n  private setDashboardStyle() {\n    const allClasses = {\n      ...this.dashboard.classes,\n      ...this.dashboard.widgetClasses\n    };\n\n    const styles = Object.keys(allClasses).map(c => c.split('-').pop());\n    styles.forEach(styleName => {\n      this.styling.themeClass = this.contextDashboardService.getStyling(\n        DASHBOARD_THEME_CLASSES,\n        styleName,\n        this.styling.themeClass\n      );\n      this.styling.headerClass = this.contextDashboardService.getStyling(\n        WIDGET_HEADER_CLASSES,\n        styleName,\n        this.styling.headerClass\n      );\n    });\n  }\n}\n","import { Injectable, Inject } from '@angular/core';\nimport { sortBy, cloneDeep } from 'lodash-es';\nimport { DynamicComponentService, DynamicComponentDefinition } from '@c8y/ngx-components';\nimport { TranslateService } from '@ngx-translate/core';\nimport { ContextDashboardConfig, CONTEXT_DASHBOARD_CONFIG } from './context-dashboard.model';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class WidgetService {\n  constructor(\n    private dynamicComponentService: DynamicComponentService,\n    private translateService: TranslateService,\n    @Inject(CONTEXT_DASHBOARD_CONFIG) public moduleConfig: ContextDashboardConfig\n  ) {}\n\n  async getWidgetDefinition(componentId): Promise<DynamicComponentDefinition> {\n    return this.dynamicComponentService.getById$(componentId).toPromise();\n  }\n\n  getWidgetDefinitions() {\n    const translatedComponents = Array.from(this.dynamicComponentService.state).map(cmp => ({\n      ...cmp,\n      label: this.translateService.instant(cmp.label)\n    }));\n\n    return cloneDeep(sortBy(translatedComponents, 'label').filter(this.moduleConfig.widgetFilter));\n  }\n}\n","import { Component, OnDestroy } from '@angular/core';\nimport { DynamicComponentDefinition, Widget } from '@c8y/ngx-components';\nimport { clone, cloneDeep, escapeRegExp, get, omit } from 'lodash-es';\nimport { BsModalRef } from 'ngx-bootstrap/modal';\nimport { iif, Subject, Subscription, timer } from 'rxjs';\nimport { switchMap } from 'rxjs/operators';\nimport {\n  ContextDashboardManagedObject,\n  WIDGET_CONTENT_CLASSES,\n  WIDGET_HEADER_CLASSES,\n  ContextWidgetConfig\n} from './context-dashboard.model';\nimport { WidgetService } from './widget.service';\nimport { ContextDashboardService } from './context-dashboard.service';\n\n@Component({\n  selector: 'c8y-widget-config',\n  templateUrl: './widget-config.component.html'\n})\nexport class WidgetConfigComponent implements OnDestroy {\n  mode: 'config' | 'select' | 'style' = 'select';\n  searchResult: DynamicComponentDefinition[];\n  components: DynamicComponentDefinition[];\n  selected: DynamicComponentDefinition;\n  searchChange$ = new Subject();\n  searchTerm = '';\n  context: any;\n  componentLabel: string;\n  mo: ContextDashboardManagedObject;\n  styling = {\n    headerClass: 'panel-title-regular',\n    contentClass: 'panel-content-light'\n  };\n  defaultStyling = {\n    headerClass: 'panel-title-regular',\n    contentClass: 'panel-content-light'\n  };\n  possibleStyling = { WIDGET_HEADER_CLASSES, WIDGET_CONTENT_CLASSES };\n  current: any;\n  widgetConfig: ContextWidgetConfig;\n  isUpgrade = false;\n\n  get isEdit() {\n    return !!this.current;\n  }\n\n  result: Promise<Widget> = new Promise((resolve, reject) => {\n    this._save = resolve;\n    this._cancel = reject;\n  });\n\n  private searchSub: Subscription;\n  private _save;\n  private _cancel;\n\n  constructor(\n    private widgetService: WidgetService,\n    private modal: BsModalRef,\n    public contextDashboardService: ContextDashboardService\n  ) {}\n\n  ngAfterContentInit(): void {\n    this.components = this.widgetService.getWidgetDefinitions();\n\n    if (this.selected) {\n      this.current = clone(this.selected);\n      this.select(this.selected, this.isEdit ? 'config' : 'select');\n    }\n\n    this.searchSub = this.searchChange$\n      .pipe(\n        switchMap((event: KeyboardEvent) => iif(() => event.which !== 13, timer(200), timer(10)))\n      )\n      .subscribe(() => {\n        this.search();\n      });\n\n    if (this.mo.c8y_Dashboard.classes) {\n      this.styling = this.setDefaultStyle({\n        ...this.mo.c8y_Dashboard.classes,\n        ...this.mo.c8y_Dashboard.widgetClasses,\n        ...(this.isEdit ? this.current.data.classes : {})\n      });\n      this.defaultStyling = this.setDefaultStyle({\n        ...this.mo.c8y_Dashboard.classes,\n        ...this.mo.c8y_Dashboard.widgetClasses\n      });\n    }\n  }\n\n  save() {\n    const { _x, _y, _width, _height } = this.selected.data;\n\n    if (this.widgetConfig && this.widgetConfig.device) {\n      const { id, name } = this.widgetConfig.device;\n      this.widgetConfig.device = { id, name };\n    }\n\n    const widget = {\n      _x,\n      _y,\n      _width,\n      _height,\n      config: omit(this.widgetConfig, 'settings'),\n      title: this.selected.data.title,\n      componentId: this.selected.id,\n      id: this.isEdit ? this.current.data.id : String(Math.random()).substr(2),\n      classes: this.getStyle(),\n      ...(!this.isEdit ? this.widgetConfig.settings.widgetDefaults : {})\n    } as Widget;\n\n    this._save(widget);\n  }\n\n  select(cmp, mode: 'select' | 'config' = 'config') {\n    cmp.data = cmp.data || {};\n    this.selected = cmp;\n\n    this.isUpgrade = !!get(cmp, 'data.settings.upgrade');\n    this.contextDashboardService.formDisabled = this.isUpgrade;\n\n    if (this.isEdit) {\n      const { _x, _y, _width, _height, classes, title } = this.current.data;\n      this.selected.data = { ...this.selected.data, _x, _y, _width, _height, classes, title };\n    }\n\n    this.widgetConfig = cloneDeep(this.composeWidgetConfig(this.selected, this.context));\n\n    this.selected.data.title = this.selected.data.title || cmp.label;\n    this.componentLabel = cmp.label;\n    this.mode = mode;\n  }\n\n  search() {\n    if (this.searchTerm.length > 0) {\n      this.searchResult = this.components.filter(cmp =>\n        new RegExp(escapeRegExp(this.searchTerm.trim()), 'i').test(cmp.label)\n      );\n    } else {\n      this.resetSearch();\n    }\n  }\n\n  resetSearch() {\n    this.searchTerm = '';\n    this.searchResult = undefined;\n  }\n\n  changeMode(mode: 'config' | 'select' | 'style') {\n    this.mode = mode;\n  }\n\n  close() {\n    this._cancel();\n    this.modal.hide();\n  }\n\n  getStyle(isPreview = false) {\n    const cssClasses = {};\n    if (isPreview || !this.isDashboardDefaultStyle(this.styling.headerClass)) {\n      cssClasses[this.styling.headerClass] = true;\n    }\n\n    if (isPreview || !this.isDashboardDefaultStyle(this.styling.contentClass)) {\n      cssClasses[this.styling.contentClass] = true;\n    }\n\n    if (isPreview) {\n      cssClasses[`dashboard-theme-${this.defaultStyling.contentClass.split('-').pop()}`] = true;\n    }\n\n    return cssClasses;\n  }\n\n  ngOnDestroy(): void {\n    this.contextDashboardService.formDisabled = true;\n    if (this.searchSub) {\n      this.searchSub.unsubscribe();\n    }\n  }\n\n  private isDashboardDefaultStyle(className) {\n    const allClasses = {\n      ...this.mo.c8y_Dashboard.classes,\n      ...this.mo.c8y_Dashboard.widgetClasses\n    };\n    const styles = Object.keys(allClasses).map(cssClass => ({ class: cssClass }));\n    const style = this.contextDashboardService.getStyling(\n      styles,\n      className.split('-').pop(),\n      undefined\n    );\n    return !!style;\n  }\n\n  private setDefaultStyle(setClasses) {\n    let contentClass = this.styling.contentClass;\n    let headerClass = this.styling.headerClass;\n\n    const styles = Object.keys(setClasses).map(c => c.split('-').pop());\n    styles.forEach(styleName => {\n      contentClass = this.contextDashboardService.getStyling(\n        WIDGET_CONTENT_CLASSES,\n        styleName,\n        contentClass\n      );\n      headerClass = this.contextDashboardService.getStyling(\n        WIDGET_HEADER_CLASSES,\n        styleName,\n        headerClass\n      );\n    });\n\n    return { headerClass, contentClass };\n  }\n\n  private composeWidgetConfig(selectedComponent, context = {}) {\n    const setting = {\n      settings: {\n        ...selectedComponent.data.settings,\n        ...get(selectedComponent.data.settings, 'ng1.options'),\n        ...get(selectedComponent.data, 'ng1.options'),\n        context\n      },\n      ...selectedComponent.data.config,\n      dashboardMo: this.mo.c8y_Dashboard\n    } as ContextWidgetConfig;\n    return this.applyTargetIfDeviceDashboard(setting);\n  }\n\n  private applyTargetIfDeviceDashboard(widgetConfig: ContextWidgetConfig) {\n    const isDeviceType = this.contextDashboardService.isDeviceType(this.mo);\n\n    if (isDeviceType) {\n      widgetConfig.settings.hideTarget = isDeviceType;\n\n      const noDeviceTarget = widgetConfig.settings.ng1\n        ? widgetConfig.settings.ng1.options.noDeviceTarget\n        : widgetConfig.settings.noDeviceTarget;\n\n      if (!noDeviceTarget) {\n        widgetConfig.device = {\n          id: this.context.id,\n          name: this.context.name\n        };\n      }\n    }\n    return widgetConfig;\n  }\n}\n","import { Component, HostBinding, Inject, Input, OnDestroy, OnInit, Renderer2 } from '@angular/core';\nimport { ActivatedRoute, Router } from '@angular/router';\nimport {\n  AlertService,\n  DashboardChildChange,\n  DashboardChildComponent,\n  DashboardSettings,\n  DynamicComponentDefinition,\n  gettext,\n  Widget,\n  WidgetChange\n} from '@c8y/ngx-components';\nimport { cloneDeep, findIndex, get, keyBy, omit, values } from 'lodash-es';\nimport { BsModalService } from 'ngx-bootstrap/modal';\nimport { Subscription } from 'rxjs';\nimport {\n  ContextDashboard,\n  ContextDashboardConfig,\n  ContextDashboardManagedObject,\n  CONTEXT_DASHBOARD_CONFIG,\n  WIDGET_HEADER_CLASSES\n} from './context-dashboard.model';\nimport { ContextDashboardService } from './context-dashboard.service';\nimport { DashboardDetailComponent } from './dashboard-detail.component';\nimport { WidgetConfigComponent } from './widget-config.component';\nimport { WidgetService } from './widget.service';\n\n/**\n * The context dashboard is a dashboard which resolves it data from the current context (device or group)\n * it is displayed on. It usually uses the route.data for it, but you can pass\n * a different managedObject to the [mo] input parameter to change that behavior.\n */\n@Component({\n  selector: 'c8y-context-dashboard',\n  templateUrl: './context-dashboard.component.html',\n  host: {\n    style: `\n      display: block;\n    `,\n    class: 'dashboard c8y-grid-dashboard'\n  }\n})\nexport class ContextDashboardComponent implements OnInit, OnDestroy {\n  @Input()\n  name: string;\n  @Input()\n  childrenClasses = '';\n  @Input()\n  context: any;\n  @Input()\n  setTitle: boolean = false;\n  @Input()\n  disabled: boolean = false;\n  @Input()\n  defaultWidgets: Widget[] = [];\n  @Input()\n  canDelete: boolean = true;\n  @Input()\n  isLoading: boolean = true;\n\n  @HostBinding('class')\n  class = '';\n\n  widgets: Widget[] = [];\n  mo: ContextDashboardManagedObject;\n  dashboard: ContextDashboard;\n\n  private dataSub: Subscription;\n\n  constructor(\n    private route: ActivatedRoute,\n    private router: Router,\n    private contextDashboardService: ContextDashboardService,\n    private alert: AlertService,\n    private renderer: Renderer2,\n    @Inject(CONTEXT_DASHBOARD_CONFIG) public moduleConfig: ContextDashboardConfig,\n    private widgetService: WidgetService,\n    private bsModal: BsModalService\n  ) {}\n\n  ngOnInit() {\n    if (!this.name) {\n      this.loadContextDashboard();\n      return;\n    }\n    this.loadNamedDashboard();\n  }\n\n  /**\n   * Applies the current context to the widget\n   * @param widget The widget to apply the context to.\n   */\n  applyDeviceTarget(widget) {\n    if (widget.config.device) {\n      widget.config.device = { id: this.context.id, name: this.context.name };\n    }\n  }\n\n  /**\n   * Removes the route listener.\n   */\n  ngOnDestroy(): void {\n    if (this.dataSub) {\n      this.dataSub.unsubscribe();\n    }\n  }\n\n  /**\n   * Restores the dashboard widgets to the default widgets.\n   */\n  async restore() {\n    this.isLoading = true;\n    this.mo.c8y_Dashboard.children = this.contextDashboardService.mapWidgets(this.defaultWidgets);\n    await this.contextDashboardService.update(this.mo);\n    this.onLoad();\n  }\n\n  /**\n   * Updates all dashboards children's. Useful for position changes on the dashboard.\n   * @param child The child to change.\n   */\n  async updateDashboardChildren(child: DashboardChildChange) {\n    const { children } = child;\n    const dashboardMO: ContextDashboardManagedObject = this.mo;\n    const mappedChildren: { [id: string]: Widget } = keyBy(\n      children.map(c => this.componentToWidget(c)),\n      'id'\n    );\n    dashboardMO.c8y_Dashboard.children = mappedChildren;\n    return this.contextDashboardService.update(dashboardMO);\n  }\n\n  /**\n   * Remove the complete dashboard and navigate away.\n   */\n  async deleteDashboard() {\n    await this.contextDashboardService.delete(this.mo);\n    if (this.route.parent) {\n      const route = this.route.parent.snapshot.url.map(segment => segment.path).join('/');\n      this.router.navigateByUrl(route);\n    }\n  }\n\n  /**\n   * Edits the current dashboard\n   */\n  async editDashboard() {\n    const initialState = {\n      dashboard: this.dashboard,\n      deviceType: this.context.type,\n      isNamedDashboard: this.contextDashboardService.isNamed(this.mo)\n    };\n    const modal = this.bsModal.show(DashboardDetailComponent, {\n      class: 'modal-lg',\n      initialState,\n      ignoreBackdropClick: true\n    }).content as DashboardDetailComponent;\n    try {\n      const dashboardMO = cloneDeep(this.mo);\n      dashboardMO.c8y_Dashboard = await modal.result;\n      await this.contextDashboardService.update(dashboardMO);\n      await this.contextDashboardService.refreshTabs(dashboardMO);\n      this.onLoad();\n      modal.close();\n    } catch (ex) {\n      // intended empty\n    }\n  }\n\n  /**\n   * Edits a widget on the dashboard.\n   * @param change The widget change event.\n   */\n  async editWidget(change: WidgetChange) {\n    const { x, y, width, height } = change.source;\n    const component = await this.widgetService.getWidgetDefinition(\n      change.widget.name || change.widget.componentId\n    );\n    if (!component) {\n      this.addWidget();\n      return;\n    }\n    await this.addWidget({\n      ...component,\n      data: { ...component.data, ...change.widget, _x: x, _y: y, _width: width, _height: height }\n    });\n  }\n\n  /**\n   * Adds a widget to the dashboard.\n   * @param selected Define a selected component to switch to edit mode directly.\n   */\n  async addWidget(selected?: DynamicComponentDefinition) {\n    const initialState = {\n      mo: this.mo,\n      context: this.context,\n      selected: cloneDeep(selected)\n    };\n\n    const modal = this.bsModal.show(WidgetConfigComponent, {\n      class: 'modal-lg',\n      initialState,\n      ignoreBackdropClick: true\n    }).content as WidgetConfigComponent;\n\n    try {\n      const newWidget = await modal.result;\n      if (!this.mo.c8y_Dashboard.children) {\n        this.mo.c8y_Dashboard.children = {};\n      }\n      this.mo.c8y_Dashboard.children[newWidget.id] = newWidget;\n      this.contextDashboardService.update(this.mo);\n      newWidget.classes = this.mergeWidgetClasses(newWidget);\n      await this.updateWidget(newWidget);\n      modal.close();\n    } catch (ex) {\n      // intended empty\n    }\n  }\n\n  /**\n   * Updates a widget or adds a new one if it doesn't exist on\n   * the dashboard.\n   * @param widget The new widget\n   */\n  async updateWidget(widget) {\n    const index = findIndex(this.widgets, { id: widget.id });\n    const isNew = index === -1;\n    const mappedWidget = await this.mapLegacy(widget);\n    if (isNew) {\n      this.widgets.push(mappedWidget);\n    } else {\n      this.widgets.splice(index, 1, mappedWidget);\n    }\n  }\n\n  /**\n   * Removes a widget and rearranges the remaining ones\n   * if necessary.\n   * @param change The change event.\n   */\n  deleteWidget(change: WidgetChange) {\n    const { widget, source } = change;\n    delete this.mo.c8y_Dashboard.children[widget.id];\n    const removed = this.widgets.find(({ id }) => id === widget.id);\n    this.widgets.splice(this.widgets.indexOf(removed), 1);\n\n    // using setTimeout to give the component the chance to remove it.\n    setTimeout(() => {\n      const child = new DashboardChildChange(source);\n      child.collapseUpAll();\n      this.updateDashboardChildren(child);\n    });\n  }\n\n  /**\n   * This is a workaround to ensure that the dragged-element\n   * (which is attached to the body) has the right styling.\n   */\n  addDashboardClassToBody() {\n    this.class.split(' ').forEach(cssClass => {\n      this.renderer.addClass(document.body, cssClass);\n    });\n  }\n\n  /**\n   * This is a workaround to ensure that the dragged-element\n   * (which is attached to the body) has the right styling.\n   */\n  removeDashboardClassFromBody() {\n    this.class.split(' ').forEach(cssClass => {\n      this.renderer.removeClass(document.body, cssClass);\n    });\n  }\n\n  /**\n   * Changes the dashboard settings to frozen or vice versa.\n   * @param settings The current settings of the dashboard.\n   */\n  async toggleFreeze(settings: DashboardSettings) {\n    this.toggleIsFrozenFlag(settings);\n    try {\n      await this.contextDashboardService.update(this.mo);\n      if (this.dashboard.isFrozen) {\n        this.alert.success(gettext('Your dashboard is locked now.'));\n      } else {\n        this.alert.success(gettext('Your dashboard is unlocked now.'));\n      }\n    } catch (ex) {\n      this.alert.addServerFailure(ex);\n      this.toggleIsFrozenFlag(settings);\n    }\n  }\n\n  private toggleIsFrozenFlag(settings: DashboardSettings) {\n    settings.isFrozen = !settings.isFrozen;\n    this.dashboard.isFrozen = settings.isFrozen;\n  }\n\n  private loadContextDashboard() {\n    this.dataSub = this.route.data.subscribe(({ dashboard }) => {\n      this.context = this.route.parent.snapshot.data.contextData;\n      this.mo = dashboard;\n      this.dashboard = this.mo.c8y_Dashboard;\n      this.onLoad();\n    });\n  }\n\n  private loadNamedDashboard() {\n    this.dataSub = this.contextDashboardService\n      .getNamedDashboardOrCreate(this.name, this.defaultWidgets)\n      .subscribe(mo => {\n        this.context = this.context || {};\n        this.mo = mo;\n        this.dashboard = this.mo.c8y_Dashboard;\n        this.onLoad();\n      });\n  }\n\n  private async onLoad() {\n    this.disabled = !this.contextDashboardService.hasPermission();\n    const dashboardChildren = cloneDeep(this.mo.c8y_Dashboard.children);\n    const isDeviceType = this.contextDashboardService.isDeviceType(this.mo);\n    const dashboardClasses = {\n      'c8y-grid-dashboard': true,\n      dashboard: true,\n      ...this.dashboard.classes\n    };\n\n    this.widgets = await Promise.all<Widget>(\n      values(dashboardChildren).map(widget => {\n        widget.classes = this.mergeWidgetClasses(widget);\n        if (isDeviceType) {\n          this.applyDeviceTarget(widget);\n        }\n        return this.mapLegacy(widget);\n      })\n    );\n    this.class = Object.keys(dashboardClasses).join(' ');\n    this.disabled = !this.contextDashboardService.hasPermission();\n    this.isLoading = false;\n  }\n\n  private mergeWidgetClasses(widget) {\n    const hasHeaderClass = WIDGET_HEADER_CLASSES.find(\n      el => widget.classes && widget.classes[el.class]\n    );\n    const widgetClasses = hasHeaderClass\n      ? { ...widget.classes }\n      : { ...this.dashboard.widgetClasses, ...widget.classes };\n    return {\n      card: true,\n      'card-dashboard': true,\n      ...widgetClasses\n    };\n  }\n\n  private componentToWidget(child: DashboardChildComponent) {\n    return {\n      ...omit(child.data, ['componentTransformConfigWithContext', 'transformConfigWithContext']), // remove legacy\n      ...({\n        _x: child.x,\n        _y: child.y,\n        _width: child.width,\n        _height: child.height\n      } as Widget)\n    };\n  }\n\n  private async mapLegacy(widget): Promise<Widget> {\n    const cmp = await this.widgetService.getWidgetDefinition(widget.componentId || widget.name);\n    if (get(cmp, 'data.settings.upgrade')) {\n      widget.widgetComponent = cmp.data.settings.widgetComponent;\n      widget.configComponent = cmp.data.settings.configComponent;\n      widget.templateUrl = cmp.data.settings.templateUrl;\n      widget.configTemplateUrl = cmp.data.settings.configTemplateUrl;\n      widget.transformConfigWithContext =\n        cmp.data.settings.componentTransformConfigWithContext ||\n        cmp.data.settings.transformConfigWithContext;\n    }\n    return widget;\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { ActivatedRouteSnapshot } from '@angular/router';\nimport { ContextDashboardType } from './context-dashboard.model';\nimport { ContextDashboardService } from './context-dashboard.service';\n\n@Injectable()\nexport class GroupDashboardGuard {\n  constructor(\n    private contextDashboardService: ContextDashboardService\n  ) {}\n\n  canActivate(route: ActivatedRouteSnapshot) {\n    return this.contextDashboardService.activateDashboards(route, [\n      ContextDashboardType.Group\n    ]);\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { Action, ActionFactory, gettext, ViewContext } from '@c8y/ngx-components';\nimport { ActivatedRoute, Router } from '@angular/router';\nimport { ContextDashboardService } from './context-dashboard.service';\nimport { BsModalService } from 'ngx-bootstrap/modal';\nimport { DashboardDetailComponent } from './dashboard-detail.component';\nimport { ContextDashboardManagedObject } from './context-dashboard.model';\n\n@Injectable()\nexport class DashboardActionsFactory implements ActionFactory {\n  constructor(\n    private router: Router,\n    private contextDashboardService: ContextDashboardService,\n    private bsModal: BsModalService\n  ) {}\n\n  get(activatedRoute: ActivatedRoute): Action[] {\n    const context =\n      !activatedRoute.parent || activatedRoute.snapshot.data.context\n        ? activatedRoute.snapshot.data\n        : activatedRoute.parent.snapshot.data;\n\n    return [\n      {\n        label: gettext('Add dashboard'),\n        priority: 2500,\n        action: () => this.addDashboard(context),\n        disabled: !this.isEnabled(context)\n      }\n    ];\n  }\n\n  async addDashboard(context) {\n    let initialState: { deviceType: string };\n\n    if (context.context === ViewContext.Device) {\n      initialState = {\n        deviceType: context.contextData.type\n      };\n    }\n\n    const modal = this.bsModal.show(DashboardDetailComponent, {\n      class: 'modal-lg',\n      initialState,\n      ignoreBackdropClick: true\n    }).content as DashboardDetailComponent;\n    try {\n      const dashboardCfg = await modal.result;\n      const dashboardMO: ContextDashboardManagedObject = await this.contextDashboardService.create(\n        dashboardCfg,\n        context\n      );\n      await this.contextDashboardService.navigateToDashboard(dashboardMO);\n      await this.contextDashboardService.refreshTabs(dashboardMO);\n      modal.close();\n    } catch (ex) {\n      // intended empty\n    }\n  }\n\n  private isEnabled(context) {\n    return (\n      this.contextDashboardService.hasPermission() &&\n      [ViewContext.Device, ViewContext.Group].includes(context.context)\n    );\n  }\n}\n","import { Component, OnInit, Input, Output, EventEmitter } from '@angular/core';\nimport { DASHBOARD_THEME_CLASSES, WIDGET_HEADER_CLASSES } from './context-dashboard.model';\nimport { ControlContainer, NgForm } from '@angular/forms';\n\n@Component({\n  selector: 'c8y-appearance-settings',\n  templateUrl: './appearance-settings.component.html',\n  viewProviders: [ { provide: ControlContainer, useExisting: NgForm } ]\n})\nexport class AppearanceSettingsComponent {\n  @Input()\n  themeClass: string = 'dashboard-theme-light';\n  @Input()\n  headerClass: string = 'panel-title-regular';\n  @Input()\n  defaultThemeClass: string;\n  @Input()\n  defaultHeaderClass: string;\n  @Output()\n  themeClassChange = new EventEmitter<string>();\n  @Output()\n  headerClassChange = new EventEmitter<string>();\n\n  @Input()\n  possibleStylingTheme = DASHBOARD_THEME_CLASSES;\n\n  @Input()\n  possibleStylingHeader = WIDGET_HEADER_CLASSES;\n\n  themeClassClick(value) {\n    value = this.resetToDefault(value, this.themeClass, this.defaultThemeClass);\n    this.themeClass = value;\n    this.themeClassChange.emit(value);\n  }\n\n  headerClassClick(value) {\n    value = this.resetToDefault(value, this.headerClass, this.defaultHeaderClass);\n    this.headerClass = value;\n    this.headerClassChange.emit(value);\n  }\n\n  private resetToDefault(value: string, compareTo: string, defaultValue: string) {\n    if (defaultValue && value === compareTo) {\n      value = defaultValue;\n    }\n    return value;\n  }\n}\n","import { Input, Component } from '@angular/core';\n\n@Component({\n  selector: 'c8y-widget-preview',\n  templateUrl: './widget-preview.component.html'\n})\nexport class WidgetPreviewComponent {\n  @Input()\n  previewClasses: { [key: string]: boolean } = {\n    'dashboard-theme-light': true,\n    'panel-title-regular': true\n  };\n\n  @Input()\n  tab: { name: string; icon: string };\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport {\n  HOOK_ONCE_ROUTE,\n  ViewContext,\n  CoreModule,\n  HOOK_ACTION\n} from '@c8y/ngx-components';\nimport { ContextDashboardService } from './context-dashboard.service';\nimport { DeviceDashboardGuard } from './device-dashboard.guard';\nimport { ContextDashboardComponent } from './context-dashboard.component';\nimport { GroupDashboardGuard } from './group-dashboard.guard';\nimport { CONTEXT_DASHBOARD_CONFIG, ContextDashboardConfig } from './context-dashboard.model';\nimport { DashboardDetailComponent } from './dashboard-detail.component';\nimport { WidgetConfigComponent } from './widget-config.component';\nimport { BsDropdownModule } from 'ngx-bootstrap/dropdown';\nimport { TooltipModule } from 'ngx-bootstrap/tooltip';\nimport { PopoverModule } from 'ngx-bootstrap/popover';\nimport { DashboardActionsFactory } from './dashboard-actions.factory';\nimport { AppearanceSettingsComponent } from './appearance-settings.component';\nimport { WidgetPreviewComponent } from './widget-preview.component';\n\nconst defaultConfig = {\n  allowFullscreen: true,\n  widgetFilter({ data }) {\n    return !(data && data.settings && data.settings.noNewWidgets);\n  },\n  routes: [\n    {\n      path: 'dashboard/:dashboardId',\n      component: ContextDashboardComponent,\n      canActivate: [DeviceDashboardGuard],\n      context: ViewContext.Device\n    },\n    {\n      path: 'dashboard/:dashboardId',\n      component: ContextDashboardComponent,\n      canActivate: [GroupDashboardGuard],\n      context: ViewContext.Group\n    }\n  ]\n};\n\n@NgModule({\n  declarations: [\n    AppearanceSettingsComponent,\n    ContextDashboardComponent,\n    WidgetConfigComponent,\n    WidgetPreviewComponent,\n    DashboardDetailComponent\n  ],\n  imports: [CoreModule, TooltipModule, PopoverModule, BsDropdownModule.forRoot()],\n  exports: [ContextDashboardComponent, WidgetConfigComponent],\n  entryComponents: [ContextDashboardComponent, WidgetConfigComponent, DashboardDetailComponent]\n})\nexport class ContextDashboardModule {\n  static config(config: ContextDashboardConfig = {}): ModuleWithProviders {\n    return {\n      ngModule: ContextDashboardModule,\n      providers: [\n        {\n          provide: CONTEXT_DASHBOARD_CONFIG,\n          useValue: { ...defaultConfig, ...config }\n        },\n        ContextDashboardService,\n        DeviceDashboardGuard,\n        GroupDashboardGuard,\n        {\n          provide: HOOK_ONCE_ROUTE,\n          useValue: { ...defaultConfig, ...config }.routes,\n          multi: true\n        },\n        {\n          provide: HOOK_ACTION,\n          useClass: DashboardActionsFactory,\n          multi: true\n        }\n      ]\n    };\n  }\n}\n","import { Component } from '@angular/core';\nimport { gettext, Widget } from '@c8y/ngx-components';\n\n@Component({\n  selector: 'c8y-cockpit-dashboard',\n  templateUrl: './cockpit-dashboard.component.html'\n})\nexport class CockpitDashboardComponent {\n  DEFAULT_HOME_WIDGETS = [\n    {\n      name: 'cockpit.welcome.widget',\n      title: gettext(''),\n      _x: 0,\n      _y: 0,\n      _height: 5,\n      _width: 12,\n      classes: { 'panel-title-hidden': true }\n    },\n    {\n      name: 'Asset Alarms',\n      title: gettext('Active, critical alarms'),\n      _x: 0,\n      _y: 5,\n      _height: 4,\n      _width: 6\n    },\n    {\n      name: 'Recent Alarms',\n      title: gettext('Recent alarms'),\n      _x: 0,\n      _y: 9,\n      _height: 4,\n      _width: 6\n    },\n    {\n      name: 'Map',\n      title: gettext('Map'),\n      _x: 6,\n      _y: 5,\n      _height: 8,\n      _width: 6\n    }\n  ] as Widget[];\n}\n","import { Component, Input, OnInit, OnDestroy } from '@angular/core';\nimport { gettext, DocsService, DocLink, NavigatorService } from '@c8y/ngx-components';\nimport { Router } from '@angular/router';\nimport { Subscription } from 'rxjs';\nimport { TenantService, ApplicationService, IApplication } from '@c8y/client';\n\n@Component({\n  selector: 'c8y-welcome-to-cockpit',\n  templateUrl: './welcome.component.html'\n})\nexport class WelcomeToCockpit implements OnInit, OnDestroy {\n  @Input() config;\n  welcomeMessage;\n  quickLinks = [];\n\n  private readonly REPORT_NODE: string = 'Reports';\n  private readonly CONFIGURATION_NODE: string = 'Configuration';\n  private readonly TRIAL: string = 'TRIAL';\n  private tenantType: string;\n  private navNodes: any[];\n  private links: DocLink[];\n  private docsSubscription: Subscription;\n  private navSubscription: Subscription;\n\n  constructor(\n    private tenantService: TenantService,\n    private docs: DocsService,\n    private router: Router,\n    private navigator: NavigatorService,\n    private applicationService: ApplicationService\n  ) {}\n\n  async ngOnInit() {\n    this.tenantType = await this.tenantService.currentTenantType();\n    this.setMessage();\n    this.navSubscription = this.navigator.items$.subscribe(nodes => {\n      this.navNodes = nodes;\n    });\n    this.docsSubscription = this.docs.items$.subscribe(links => {\n      this.links = links;\n    });\n\n    // <---TRIAL & REGULAR TENANT --->\n    this.createConnectSmartphoneQuickLink();\n    await this.createQuicklinkRegisterDevice();\n\n    // <--- TRIAL TENANT --->\n    if (this.tenantType === this.TRIAL) {\n      this.createQuicklinkUserGuide();\n      return;\n    }\n\n    // <--- REGULAR TENANT --->\n    this.createQuicklinkAddGroup();\n    this.createQuickLinkReports();\n    this.createQuicklinkDataPointLibrary();\n    this.createQuicklinkSmartRules();\n  }\n\n  ngOnDestroy() {\n    if (this.docsSubscription && !this.docsSubscription.closed) {\n      this.docsSubscription.unsubscribe();\n    }\n\n    if (this.navSubscription && !this.navSubscription.closed) {\n      this.navSubscription.unsubscribe();\n    }\n  }\n\n  private setMessage() {\n    if (this.tenantType === this.TRIAL) {\n      this.welcomeMessage = gettext(`\n        The Cockpit application allows you to build IoT applications in minutes.\n        To get started, connect any device to the platform.\n        If you do not have an IoT device to hand, you can start by connecting your smartphone.\n        Click below to be guided through the process.\n      `);\n    } else {\n      this.welcomeMessage = gettext(`\n        The Cockpit application provides you with options to manage\n        and monitor Internet of Things assets and data from business perspective.\n      `);\n    }\n  }\n\n  private createQuicklinkAddGroup() {\n    // comes from angularJS factory c8yQuickLinks\n    const addGroup: Partial<DocLink> = this.links.find(link => link.label === 'Add group');\n    if (addGroup) {\n      this.quickLinks.push(addGroup);\n    }\n  }\n\n  private createConnectSmartphoneQuickLink() {\n    // Provider in SensorPhoneModule defines the\n    // 'Connect smartphone' quicklink.\n    const connectSmartphone = this.links.find(link => link.label === 'Connect smartphone');\n    if (connectSmartphone) {\n      this.quickLinks.push(connectSmartphone);\n    }\n  }\n\n  private createQuickLinkReports() {\n    const reports: Partial<DocLink> = {\n      icon: 'c8y-reports',\n      label: gettext('Reports'),\n      url: '/export'\n    };\n\n    const reportsNode = this.findNavigatorNode(this.REPORT_NODE);\n    if (reportsNode && reportsNode.show) {\n      reports.click = () => {\n        reportsNode.open = true;\n        this.router.navigateByUrl(reports.url);\n      };\n      this.quickLinks.push(reports);\n    }\n  }\n\n  private createQuicklinkDataPointLibrary() {\n    const dataPointLib: Partial<DocLink> = {\n      icon: 'c8y-data-points',\n      label: gettext('Data point library'),\n      url: '/datapointlibrary'\n    };\n\n    const configurationNode = this.findNavigatorNode(this.CONFIGURATION_NODE);\n    if (configurationNode && configurationNode.show) {\n      dataPointLib.click = () => {\n        configurationNode.open = true;\n        this.router.navigateByUrl(dataPointLib.url);\n      };\n      this.quickLinks.push(dataPointLib);\n    }\n  }\n\n  private createQuicklinkSmartRules() {\n    const smartRules: Partial<DocLink> = {\n      icon: 'c8y-smart-rules',\n      label: gettext('Smart rules'),\n      url: '/rules'\n    };\n    const configurationNode = this.findNavigatorNode(this.CONFIGURATION_NODE);\n    if (configurationNode && configurationNode.show) {\n      smartRules.click = () => {\n        configurationNode.open = true;\n        this.router.navigateByUrl(smartRules.url);\n      };\n      this.quickLinks.push(smartRules);\n    }\n  }\n\n  private async createQuicklinkRegisterDevice() {\n    const { data } = await this.applicationService.listByUser();\n    if (data) {\n      const deviceManagement: IApplication = data.find(\n        app => app.contextPath === 'devicemanagement'\n      );\n      if (deviceManagement) {\n        const deviceMgmtUrl = this.applicationService.getHref(deviceManagement);\n        const registerDevice: Partial<DocLink> = {\n          icon: 'c8y-device-connect',\n          label: gettext('Register device'),\n          click: () => window.open(`${deviceMgmtUrl}/#/deviceregistration`, '_self')\n        };\n        this.quickLinks.push(registerDevice);\n      }\n    }\n  }\n\n  private createQuicklinkUserGuide() {\n    const userGuide: Partial<DocLink> = {\n      icon: 'c8y-user',\n      label: gettext('User guide'),\n      url: '/users-guide/getting-started',\n      click: () => {\n        const userGuideURL = this.docs.getUserGuideLink(userGuide.url) as string;\n        window.open(userGuideURL);\n      }\n    };\n    this.quickLinks.push(userGuide);\n  }\n\n  private findNavigatorNode(nodeRealName: string) {\n    if (this.navNodes && this.navNodes.length > 0) {\n      return this.navNodes.find((node: any) => node.realName === nodeRealName);\n    }\n    return undefined;\n  }\n}\n","import { Component, Host } from '@angular/core';\r\nimport { ContextDashboardComponent } from '../context-dashboard.component';\r\n\r\n@Component({\r\n  selector: 'c8y-legacy-welcome-widget',\r\n  templateUrl: './legacy-welcome.component.html'\r\n})\r\nexport class LegacyWelcomeComponent {\r\n  constructor(@Host() private dashboard: ContextDashboardComponent) {}\r\n\r\n  restore() {\r\n    this.dashboard.restore();\r\n  }\r\n}\r\n","import { NgModule } from '@angular/core';\nimport { ContextDashboardModule } from './context-dashboard.module';\nimport { ContextDashboardComponent } from './context-dashboard.component';\nimport { DeviceDashboardGuard } from './device-dashboard.guard';\nimport { GroupDashboardGuard } from './group-dashboard.guard';\nimport {\n  ViewContext,\n  HOOK_NAVIGATOR_NODES,\n  gettext,\n  CoreModule,\n  HOOK_COMPONENTS,\n  DynamicComponentDefinition,\n  QuickLinkModule,\n  DocsModule\n} from '@c8y/ngx-components';\nimport { CockpitDashboardComponent } from './cockpit-dashboard.component';\nimport { ContextWidgetConfig } from './context-dashboard.model';\nimport { WelcomeToCockpit } from './welcome/welcome.component';\nimport { TranslateModule } from '@ngx-translate/core';\nimport { LegacyWelcomeComponent } from './legacy-welcome/legacy-welcome.component';\n\n// import for the preview img to get into the build.\nlet previewImage = '';\ntry {\n  // tslint:disable-next-line: no-var-requires\n  previewImage = require('./welcome/img/welcome-widget-pr.png');\n} catch (ex) {\n  // intended empty\n}\n\n@NgModule({\n  entryComponents: [CockpitDashboardComponent, WelcomeToCockpit, LegacyWelcomeComponent],\n  imports: [\n    DocsModule,\n    CoreModule,\n    ContextDashboardModule.config({\n      routes: [\n        {\n          path: 'dashboard/:dashboardId',\n          component: ContextDashboardComponent,\n          canActivate: [DeviceDashboardGuard],\n          context: ViewContext.Device\n        },\n        {\n          path: 'dashboard/:dashboardId',\n          component: ContextDashboardComponent,\n          canActivate: [GroupDashboardGuard],\n          context: ViewContext.Group\n        },\n        {\n          path: '',\n          component: CockpitDashboardComponent\n        }\n      ]\n    }),\n    QuickLinkModule,\n    TranslateModule\n  ],\n  declarations: [CockpitDashboardComponent, WelcomeToCockpit, LegacyWelcomeComponent],\n  providers: [\n    {\n      provide: HOOK_NAVIGATOR_NODES,\n      useValue: [{ label: gettext('Home'), icon: 'home', priority: 10000, path: '/' }],\n      multi: true\n    },\n    {\n      provide: HOOK_COMPONENTS,\n      multi: true,\n      useValue: [\n        {\n          id: 'cockpit.welcome.widget',\n          label: gettext('Welcome to Cockpit'),\n          description: gettext('Displays a welcome message for Cockpit'),\n          component: WelcomeToCockpit,\n          previewImage,\n          data: {\n            settings: {\n              noNewWidgets: false,\n              widgetDefaults: {\n                _width: 12,\n                _height: 6\n              },\n              ng1: {\n                options: {\n                  noDeviceTarget: true,\n                  groupsSelectable: false\n                }\n              }\n            }\n          } as ContextWidgetConfig\n        }\n      ] as DynamicComponentDefinition[]\n    },\n    {\n      provide: HOOK_COMPONENTS,\n      multi: true,\n      useValue: [\n        {\n          id: 'Cockpit Welcome',\n          label: gettext('Welcome to Cockpit'),\n          description: gettext('Displays a welcome message for Cockpit'),\n          component: LegacyWelcomeComponent,\n          data: {\n            settings: {\n              noNewWidgets: true,\n              ng1: {\n                options: {\n                  noDeviceTarget: true,\n                  groupsSelectable: false\n                }\n              }\n            }\n          } as ContextWidgetConfig\n        }\n      ] as DynamicComponentDefinition[]\n    }\n  ]\n})\nexport class CockpitDashboardModule {}\n"]}