"use strict";function _toConsumableArray(t){return _arrayWithoutHoles(t)||_iterableToArray(t)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}function _arrayWithoutHoles(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}function asyncGeneratorStep(t,e,n,r,a,s,i){try{var o=t[s](i),c=o.value}catch(t){return void n(t)}o.done?e(c):Promise.resolve(c).then(r,a)}function _asyncToGenerator(o){return function(){var t=this,i=arguments;return new Promise(function(e,n){var r=o.apply(t,i);function a(t){asyncGeneratorStep(r,e,n,a,s,"next",t)}function s(t){asyncGeneratorStep(r,e,n,a,s,"throw",t)}a(void 0)})}}!function(){function t(e,s,a,n,r,i,o,c,u){var l=this;function t(){return(t=_asyncToGenerator(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r.changeTitle({title:u("Cell ID usage statistics")}),t.next=3,f();case 3:case"end":return t.stop()}},t)}))).apply(this,arguments)}function f(){return m.apply(this,arguments)}function m(){return(m=_asyncToGenerator(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return d(),t.next=3,p();case 3:l.subtenantList.columns=c.getSubtenantListColumns(),l.subtenantList.csvHeaders=_.map(l.subtenantList.columns,function(t){return _.get(t,"header.csv")||_.get(t,"header.text")||_.get(t,"header")}),l.subtenantList.filteredSortedStatisticsItems=y(),e.$apply();case 7:case"end":return t.stop()}},t)}))).apply(this,arguments)}function d(){var t=a.dateFrom,e=a.dateTo,n=moment().startOf("month").toDate(),r=moment().add(1,"day").toDate();l.dateFrom=o.stringToDate(t)||n,l.dateTo=o.stringToDate(e)||r}function p(){return g.apply(this,arguments)}function g(){return(g=_asyncToGenerator(regeneratorRuntime.mark(function t(){var e,n,r,a;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e=S(),t.next=3,s.all({tenantStatistics:c.getTenantStatisticsFor(e),subtenantsStatistics:c.getSubtenantsStatisticsFor(e)});case 3:n=t.sent,r=n.tenantStatistics,a=n.subtenantsStatistics,l.tenantStatistics=r,l.subtenantList.statisticsItems=a;case 8:case"end":return t.stop()}},t)}))).apply(this,arguments)}function S(){return{dateFrom:o.dateToString(l.dateFrom),dateTo:o.dateToString(l.dateTo)}}function y(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:l.subtenantList.columnsConfig;l.subtenantList.columnsConfig=t;var e=l.subtenantList,n=e.statisticsItems,r=e.columns;return i.filterSort(n,r,t)}_.assign(l,{$onInit:function(){return t.apply(this,arguments)},refresh:f,doFilter:function(){var t=S();t.dateFrom&&t.dateTo&&n.search(t)},clearFilter:function(){n.search({})},tenantStatistics:{tenantId:void 0,apiRequests:0,activeDevices:0},subtenantList:{csvHeaders:[],csvData:function(){return _.map([l.tenantStatistics].concat(_toConsumableArray(l.subtenantList.filteredSortedStatisticsItems)),function(t){return _.at(t,["tenantId","apiRequests","activeDevices"])})},columns:[],columnsConfig:{},onColumnsConfigChanged:function(t){l.subtenantList.filteredSortedStatisticsItems=y(t)},statisticsItems:[],filteredSortedStatisticsItems:[],goToSubtenant:function(t){var e=t.tenantId;n.path("/tenants/".concat(e))}}})}t.$inject=["$rootScope","$q","$routeParams","$location","c8yTitle","c8yFilteringSortingCollections","c8yUtil","cellIdUsageStatisticsService","gettext"],angular.module("c8y.cellIdUsageStatistics").component("c8yCellIdUsageStatistics",{templateUrl:":::PLUGIN_PATH:::/cell-id-usage-statistics.html",controllerAs:"vm",controller:t})}();