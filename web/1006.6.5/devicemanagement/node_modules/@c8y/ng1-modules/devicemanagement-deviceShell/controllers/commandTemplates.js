"use strict";function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}!function(){function e(e,n,t,a,r,l,i,o,m){var c,d,s=this,y=[],u=r.getDeliveryTypes().defaultDeliveryType,p=r.getDeliveryTypes().standardDeliveryTypes;function T(e){y.length=0,_.forEach(e,function(e){var t=!!e.id;y.push({name:t?e.name:m.getString(e.name),command:e.command,category:t?e.category:m.getString(e.category),deliveryTypes:e.deliveryTypes,id:e.id})})}function v(e){s.result.commandTemplate=e,_.difference(e.deliveryTypes,p)||s.standardDeliveryTypes.push(e.deliveryType),s.commandDeliveryType=_.first(e.deliveryTypes)||u}_.assign(s,{commandTemplates:y,standardDeliveryTypes:p,defaultDeliveryType:u,commandDeliveryTypesSelected:{},validateSelectedDeliveryTypes:function(){return _.isEmpty(_.pickBy(s.commandDeliveryTypesSelected))},result:{action:null,commandTemplate:null},forms:{},onTemplateSelected:v,use:function(e){s.result.action="USE",s.result.deliveryType=e!==u&&e,s.result.commandTemplate=_.clone(s.result.commandTemplate);var t=s.result.commandTemplate;t.text=t.text||t.command,n.close(s.result)},execute:function(e){s.result.action="EXECUTE",s.result.deliveryType=e!==u&&e,s.result.commandTemplate=_.clone(s.result.commandTemplate);var t=s.result.commandTemplate;t.text=t.command,n.close(s.result)},cancel:function(){s.newCommandTemplate?delete s.newCommandTemplate:n.dismiss()},save:function(){s.newCommandTemplate.deliveryTypes=_.keys(_.pickBy(s.commandDeliveryTypesSelected)),r.saveTemplate(s.newCommandTemplate).then(t.getResData).then(function(e){var t=_.pick(e,["id","name","category","command","text","deliveryTypes"]),n=_.find(y,{id:t.id});n?_.assign(n,t):y.unshift(t),v(s.result.commandTemplate=t),delete s.newCommandTemplate})},addNew:function(){s.newCommandTemplate={deviceType:c},s.commandDeliveryTypesSelected=_defineProperty({},u,!0)},hideAddButton:function(){return!!s.newCommandTemplate},edit:function(e){var t;t=_.isEmpty(e.deliveryTypes)?p:e.deliveryTypes;_.forEach(t,function(e){_.assign(s.commandDeliveryTypesSelected,_defineProperty({},e,!0))}),s.newCommandTemplate=e},remove:function(e){s.result.commandTemplate===e&&delete s.result.commandTemplate;r.removeTemplate(e).then(function(){_.pull(y,e)}).then(function(){i.success(o("Shell command template deleted."))})},isDeliveryTypeSupported:function(e,t){var n=_.get(t,"deliveryTypes");return _.isEmpty(n)||_.includes(n,e)},getExecuteButtonLabel:function(e){return e!==u?m.getString("Execute (via {{ deliveryType | translate }})",{deliveryType:e}):m.getString("Execute")},appendToEl:document.getElementsByClassName("modal")}),(d=e.deviceId,a.detailCached(d).then(t.getResData).then(function(e){return c=_.concat(e.type,e.c8y_DeviceTypes||[]),r.getCommandTemplatesForDeviceType.apply(r,_toConsumableArray(c))})).then(T),r.canSendCommandsViaSMS().then(function(e){s.smsEnabled=e}),l.hasAnyRole(["ROLE_INVENTORY_ADMIN"]).then(function(e){s.canWrite=e})}e.$inject=["$routeParams","$uibModalInstance","c8yBase","c8yDevices","c8yDeviceShell","c8yPermissions","c8yAlert","gettext","gettextCatalog"],angular.module("c8y.deviceShell").controller("commandTemplatesCtrl",e)}();