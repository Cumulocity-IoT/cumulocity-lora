"use strict";function _slicedToArray(n,t){return _arrayWithHoles(n)||_iterableToArrayLimit(n,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function _iterableToArrayLimit(n,t){if(Symbol.iterator in Object(n)||"[object Arguments]"===Object.prototype.toString.call(n)){var e=[],r=!0,o=!1,a=void 0;try{for(var i,c=n[Symbol.iterator]();!(r=(i=c.next()).done)&&(e.push(i.value),!t||e.length!==t);r=!0);}catch(n){o=!0,a=n}finally{try{r||null==c.return||c.return()}finally{if(o)throw a}}return e}}function _arrayWithHoles(n){if(Array.isArray(n))return n}!function(){function n(e,i,n,r,t,o,a,y){var c=[{key:"appLogo",filename:"logo-nav",cssVar:"navigator-platform-logo"},{key:"brand-logo-img",filename:"logo",cssVar:"brand-logo-img"},{key:"favicon",filename:"favicon",option:"faviconUrl"}],l=["__import-font","html_title"],f=["cookieBannerTitle","cookieBannerText","policyUrl"];return{keyToCssVar:u,getFontFamilyCssVar:g,reset:function(){return s(),n.remove().then(function(){return i.remove()})},deploy:function(t){var e={},r={brandingCssVars:e},o=function(n){return _.assign(e,n)},a=function(n){return _.assign(r,n)};return o(function(r){var n=c.map(function(n){var t=n.key;return t}).concat(l,f),o={};return _.keys(_.omit(r,n)).forEach(function(n){var t=r[n];if(_.isNumber(t)){var e="px";/logo.*height/i.test(n)&&(e="%"),t="".concat(t).concat(e)}o[u(n)]=t}),o["navigator-font-family"]=g(o["navigator-font-family"]),o}(t)),a(function(n){var t={};if(n.html_title&&(t.globalTitle=n.html_title),n["__import-font"]){var e=n["__import-font"];t.extraCssUrls=[e]}return t.cookieBanner=_.pick(n,f),t}(t)),i.contextPath().then(function(n){return function(f,s){var u=[],g={},p={};return c.forEach(function(n){var t=n.key,e=n.cssVar,r=n.filename,o=n.option;if(s[t]){var a=function(n){for(var t=atob(n.split(",")[1]),e=_slicedToArray(n.split(",")[0].split(":")[1].split(";"),1)[0],r=new ArrayBuffer(t.length),o=new Uint8Array(r),a=0;a<t.length;a++)o[a]=t.charCodeAt(a);return new Blob([r],{type:e})}(s[t].fileSrc),i=function(t){return _.find(["jpg","jpeg","svg","png","gif","webp","ico"],function(n){return new RegExp(n).test(t)})}(a.type),c="?nocache=".concat(String(Math.random()).substr(2)),l="".concat(r,".").concat(i);e&&(g[e]="url(/apps/public/".concat(f,"/").concat(l).concat(c,")")),o&&(p[o]="/apps/public/".concat(f,"/").concat(l).concat(c)),u.push(y([a],l))}}),i.update(u).then(function(){return{cssVars:g,options:p}})}(n,t)}).then(function(n){var t=n.cssVars,e=n.options;o(t),a(e)}).then(function(){return n.save(r)}).then(s)},removeLegacyBrandedApplications:function(){return r.listByOwner().then(function(n){return n.filter(function(n){return n.manifest&&n.manifest.originalAppId&&n.manifest.originalActiveVersionId})}).then(function(n){return 0<n.length?t({status:"danger",title:a("Delete legacy branded applications"),body:a("Before applying new branding configuration, legacy branded applications must be deleted.")}).then(function(){return function(n){var t=[];return n.forEach(function(n){return t.push(r.remove(n))}),e.all(t)}(n)}).then(function(){return o.success(a("Legacy branded applications deleted."))},function(n){return o.danger(n)}):e.resolve()})}};function s(){window.localStorage.removeItem("OPTIONS")}function u(n){return{navColor:"navigator-bg-color",navColorHeader:"navigator-header-bg","appLogo-height":"navigator-platform-logo-height","font-family-sans-serif":"font-family-base","headings-font-family":"font-family-headings","brand-logo-height":"brand-logo-img-height"}[n]||_.kebabCase(n)}function g(n){return"var(--".concat({"@font-family-sans-serif":"font-family-base","@headings-font-family":"font-family-headings"}[n],")")}}n.$inject=["$q","c8yUiAssets","c8yPublicOptions","c8yApplication","c8yModal","c8yAlert","gettext","createFile"],angular.module("c8y.custom-branding").factory("c8yBrandingDeploy",n)}();