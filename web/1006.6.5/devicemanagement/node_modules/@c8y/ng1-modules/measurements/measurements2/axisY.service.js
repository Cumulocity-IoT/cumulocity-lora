"use strict";function _toConsumableArray(t){return _arrayWithoutHoles(t)||_iterableToArray(t)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}function _arrayWithoutHoles(t){if(Array.isArray(t)){for(var e=0,r=new Array(t.length);e<t.length;e++)r[e]=t[e];return r}}function _slicedToArray(t,e){return _arrayWithHoles(t)||_iterableToArrayLimit(t,e)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function _iterableToArrayLimit(t,e){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t)){var r=[],i=!0,n=!1,a=void 0;try{for(var o,s=t[Symbol.iterator]();!(i=(o=s.next()).done)&&(r.push(o.value),!e||r.length!==e);i=!0);}catch(t){n=!0,a=t}finally{try{i||null==s.return||s.return()}finally{if(n)throw a}}return r}}function _arrayWithHoles(t){if(Array.isArray(t))return t}!function(){function t(y){function t(t){var e=this;(e.chart=t).addItem(e),e.series=[]}return t.prototype={indexPosition:function(){return this.chart.getAxisY().indexOf(this)},indexPositionInSide:function(){var t=this,e=t.orientation();return t.chart.getAxisYByOrientation(e).indexOf(t)},orientation:function(){return this.firstSeries().dataPoint.yAxisType||this.autoOrientation()},autoOrientation:function(){var r=this,t="left",e=r.chart.getAxisY(),i=e.indexOf(r),n=_.findIndex(e,function(t){var e=t.firstSeries().dataPoint.yAxisType;return t!==r&&(!e||"left"===e)});return-1<n&&n<i&&(t="right"),t},addSerie:function(t){this.series.push(t)},firstSeries:function(){return this.series[0]||{dataPoint:{}}},axis:function(){var r=this;r.strictValues=[];var i=d3.format(".2s");return d3.svg.axis().scale(r.scale()).orient(r.orientation()).ticks(6).tickFormat(function(t){var e={originalValue:t,formattedValue:4<String(t).length?i(t):t};return r.strictValues.push(e),e.formattedValue})},scale:function(){var t,e=_slicedToArray(this.series,1)[0];return e&&(t=e.scale()),t},remove:function(){this.chart.removeItem(this),this.el&&this.el.remove()},render:function(){var t=this,e=t.axis(),r=t.el,i=t.chart.box(),n=t.chart.margins,a=t.chart.sizes.yAxisWidth,o=n.t,s="left"===t.orientation(),l=(t.indexPositionInSide()+1)*a,c=s?n.l+l:i.width-n.r-l;if(!r){var u=t.chart.svg;t._id="axis".concat(String(Math.random()).substr(2)),t.el=u.append("g").attr({class:"yaxis axis",id:t._id}),r=t.el,t.circles=r.append("g").attr({class:"circles"}),t.label=r.append("text").style({fill:"#999","font-size":"10px"})}var d=s?-35:35,h=i.height/2,f=s?-90:90;t.label.attr({x:d,y:h,"text-anchor":"middle",transform:y.rotate(f,d,h)}),t.label.text(t.labelText()),r.attr("transform",y.translate(c,o)),r.call(e),!t.addElRendered&&0<i.height&&(t.renderAdditionalElements(),t.addElRendered=!0)},renderAdditionalElements:function(){var t=this,e=_.uniqBy(t.strictValues,"formattedValue").length!==t.strictValues.length;t.renderCircles(e),e&&(t.reformatTickText(),t.renderStrictValues())},renderCircles:function(n){var a=this,t=a.chart,o=a.circles,s=a.el,e=a.series,l="right"===a.orientation()?35:-35,r=t.box(),i=t.margins,c=r.height-i.t-i.b-15;o.selectAll("circle").remove(),o.selectAll(".seriesColorLine").remove(),_.forEach(e,function(t,e){var r=t.dataPoint,i=o.append("circle").attr({cx:l,cy:c-7*e,r:5,fill:r.color});o.append("line").attr({x1:l,x2:0,y1:c-7*e,y2:c-7*e,style:"stroke:".concat(r.color,";stroke-width:2"),class:"seriesColorLine"}),n&&i.on("mouseover",function(){s.selectAll(".tick").attr({visibility:"hidden"}),a.chart.svg.append("use").attr({href:"#strictValues".concat(a._id),transform:s.attr("transform")})}).on("mouseout",function(){s.selectAll(".tick").attr({visibility:"visible"}),a.chart.svg.selectAll("use").remove()})})},reformatTickText:function(){var i=this,t=_slicedToArray(i.el.selectAll(".tick").select("text"),1)[0];_.forEach(t.slice(1,-1),function(t,e){var r=String(i.strictValues.slice(1,-1)[e].originalValue);4<r.length&&(t.innerHTML="&hellip;".concat(r.substr(-2)))})},renderStrictValues:function(){var i=this,t=i.el,e=_slicedToArray(t.selectAll(".tick"),1)[0],n=_.chain(e).map(function(t){return t.transform.baseVal.consolidate().matrix.f}).sortBy().reverse().value(),r=i.strictValues,a=6.25*Math.max.apply(Math,_toConsumableArray(r.map(function(t){return String(t.originalValue).length})))+20,o="right"===i.orientation()?-a:0;t.selectAll("g[strictValuesFor=".concat(i._id,"]")).remove();var s=t.append("g").attr({visibility:"hidden",strictValuesFor:i._id}).append("g").attr({id:"strictValues".concat(i._id)});_.forEach(r,function(t,e){var r=s.append("g").attr({class:"strictValue",strictValueFor:i._id});r.append("rect").attr({x:o,y:n[e]-10,width:a,height:20}),r.append("text").attr({x:10+o,y:n[e]+3,fill:"white"}).text(t.originalValue)})},labelText:function(){var t="",e=this.series;if(1===e.length){var r=_slicedToArray(e,1)[0].dataPoint;t=r.label+(r.unit?" [".concat(r.unit,"]"):"")}else t=_.uniqBy(_.filter(_.map(e,function(t){return t.dataPoint.unit}),_.identity)).join(" / ");return t}},t}t.$inject=["c8yChartCommon"],angular.module("c8y.core.measurements2").factory("c8yAxisY",t)}();