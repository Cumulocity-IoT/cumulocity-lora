"use strict";function _toConsumableArray(t){return _arrayWithoutHoles(t)||_iterableToArray(t)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}function _arrayWithoutHoles(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}!function(){function t(n,t,a,e,r,i){var o=this,l="two-factor-authentication",s=i("TOTP requires OAuth Internal login mode."),u=i("Messaging application is not subscribed."),c=[{systemOption:!0,key:"tenant-scope-settings.enabled",default:!1,readOnly:!0},{key:"enabled",default:!1,loader:p},{key:"token.validity",default:43200,readOnlyIfTenantScopeSettingsDisabled:!0},{key:"pin.validity",default:30,readOnlyIfTenantScopeSettingsDisabled:!0},{key:"enforced",default:!1,loader:p},{key:"strategy",default:"SMS"}];function y(e){var t=d(e),n=e.default;return(e.systemOption?a.getSystemOptionValue(t,n):"function"==typeof e.loader?e.loader():a.detailValue(t,n)).then(function(t){return function(t,e){o[f(t.key)]=e}(e,t)})}function d(t){return{category:l,key:t.key}}function f(t){return _.camelCase(t)}function g(t){var e={category:l,key:t.key,value:function(t){return function(t){return _.isNumber(t)||!_.isNaN(_.toNumber(t))&&_.isString(t)?_.toNumber(t):t}(o[f(t.key)])}(t)};return function(t){var e=t.readOnly,n=t.readOnlyIfTenantScopeSettingsDisabled&&!o.tenantScopeSettingsEnabled;return!t.systemOption&&!(e||n)}(t)?a.updateOption(e):n.when()}function p(){var e=this,n=d(this);return a.getSystemOptionValue(n,this.default).then(function(t){return!0===t?e.readOnly=!0:a.detailValue(n,e.default)})}_.assign(o,{$onInit:function(){n.all([].concat(_toConsumableArray(_.map(c,y)),[void t.isAvailable({contextPath:"messaging"}).then(function(t){o.smsAppAvailable=t})])).finally(function(){o.initialized=!0})},saveSettings:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:o.tfaSettingsForm;o.enabled&&"TOTP"===o.strategy||(o.enforced=!1);var e=_.map(c,g);return n.all(e).then(function(){r.success(i("TFA settings saved.")),t&&t.$setPristine()})},limitValidityRegex:/^[0-9]\d*$/,initialized:!1,totpPopover:s,smsWarningPopover:u,oAuthLoginMode:function(){return o.loginMode===e.loginOptions.OAUTH2_INTERNAL.value.toUpperCase()},isReadOnly:function(a){return c.some(function(t){var e=t.key,n=t.readOnly;return e===a&&n})}})}t.$inject=["$q","c8yApplication","c8ySettings","c8yLoginOptions","c8yAlert","gettext"],angular.module("c8y.parts.tfaSettings").component("c8yTfaSettings",{controller:t,controllerAs:"vm",templateUrl:":::PLUGIN_PATH:::/tfa-settings.html",bindings:{loginMode:"<"}})}();