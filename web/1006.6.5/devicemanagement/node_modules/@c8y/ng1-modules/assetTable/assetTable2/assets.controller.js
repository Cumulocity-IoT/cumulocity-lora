"use strict";function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function _iterableToArrayLimit(e,t){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)){var n=[],r=!0,i=!1,o=void 0;try{for(var c,s=e[Symbol.iterator]();!(r=(c=s.next()).done)&&(n.push(c.value),!t||n.length!==t);r=!0);}catch(e){i=!0,o=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw o}}return n}}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}!function(){function e(c,t,e,n,r,i,o,s,a,u,l){var f={};function d(e){c.properties=[],f={},c.renderedDevices=f,c.parentId=e.device&&e.device.id||e.options&&e.options.parentId,u.list().then(angular.bind(l,l.filterAndExtendWithStoredProperties,c.child.config.options.properties)).then(p).then(function(e){c.properties=e,c.parentId?function(e){return t.all([n.childDevices(e),n.childAssets(e)]).then(_.flattenDeep)}(c.parentId).then(y).then(v):c.devices=_.map(c.devices,g)})}function p(e){return _.filter(e,"__active")}function y(e){return t.all(_.map(e,function(e){return n.detailRealtime(e,c)})).then(_.flattenDeep)}function v(e){c.devices=e,function(e){n.detailRealtime(e,c).then(h)}(c.parentId)}function h(e){r.isGroup(e)||(c.devices||(c.devices=[]),c.devices.push(e))}function b(e){var t=e;_.isArray(t)&&(t=t.join("."));var n=_slicedToArray(t.match(/^(-?)(.*)$/),3),r=n[1],i=n[2],o="-"===r?"desc":"asc";-1<i.indexOf("lastMeasurement")?c.devices=_.orderBy(c.devices,[function(n){return function(e){if("object"!==_typeof(e[n])&&""!==e[n]){var t=String(e[n]).split("|");if(2===t.length)return moment(t[0],"L, LTS").toDate()}}}(i),function(n){return function(e){if("object"!==_typeof(e[n])&&""!==e[n]){var t=String(e[n]).split("|");return 2===t.length?parseFloat(t[1]):parseFloat(t[0])}}}(i)],[o,o]):c.devices=_.orderBy(c.devices,i,o),c.$broadcast("c8yScrollLoad::refresh")}function g(e){return a.attach(e),s.attach(e,c.properties),e}c.$watch("child.config",function(e,t){e&&!_.isEqual(e,t)&&d(c.child.config)}),_.assign(c,{getArrows:function(e){return!!c.child.config.options.arrows[e]},orderBy:b,orderDownBy:function(e){var t=e;_.isArray(t)&&(t=t.join("."));b("-".concat(t))},buildFields:function(e,t){return function(e,t){for(var n=e,r=0;r<(t||[]).length&&null!=n;r++)n=n[t[r]];return n}(e,t)},getAssetLinkIfNeeded:function(e,t){var n=null;(function(e){return e===_.findIndex(c.properties,function(e){var t=e.renderType;return _.isUndefined(t)})})(t)&&(n=l.getAssetLink(e));return n},setArrows:function(e){c.child.config.options.arrows[e]=!c.child.config.options.arrows[e]},renderedDevices:f,renderDevice:function(e){var t=e.id;f[t]||(g(e),f[t]=!0)},renderedAllDevices:function(){return Boolean(c.devices&&c.devices.length===_.keys(f).length)}}),d(c.child.config)}e.$inject=["$scope","$q","$filter","c8yInventory","c8yGroups","c8yBase","c8yDevices","c8yComputedProperties","c8yObjectActions","c8yPropertiesLibrary","assetsSvc"],angular.module("c8y.assets").controller("AssetsCtrl",e)}();