"use strict";function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e)){for(var n=0,t=new Array(e.length);n<e.length;n++)t[n]=e[n];return t}}function asyncGeneratorStep(e,n,t,r,a,o,i){try{var c=e[o](i),u=c.value}catch(e){return void t(e)}c.done?n(u):Promise.resolve(u).then(r,a)}function _asyncToGenerator(c){return function(){var e=this,i=arguments;return new Promise(function(n,t){var r=c.apply(e,i);function a(e){asyncGeneratorStep(r,n,t,a,o,"next",e)}function o(e){asyncGeneratorStep(r,n,t,a,o,"throw",e)}a(void 0)})}}function _objectSpread(n){for(var e=1;e<arguments.length;e++){var t=null!=arguments[e]?Object(arguments[e]):{},r=Object.keys(t);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(t).filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.forEach(function(e){_defineProperty(n,e,t[e])})}return n}function _defineProperty(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}!function(){function e(e,n,t,r,o){var i,a,c,u,s,p,l=r.DEFAULT_ANIMATION_STEP_DELAY,f=this,g=_.debounce(function(){return y.apply(this,arguments)},250);function y(){return(y=_asyncToGenerator(regeneratorRuntime.mark(function e(){var n,t,r,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=(n=i).source,r=n.dateFrom,a=n.dateTo,t&&r&&a)return f.trackingEvents=[],e.next=5,o.getTrackingEventsFor(i);e.next=7;break;case 5:b(e.sent);case 7:case"end":return e.stop()}},e)}))).apply(this,arguments)}function d(){f.playing&&(f.step<u.length-1?(f.step+=1,k()):v())}function m(){return(m=_asyncToGenerator(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.paging.loading=!0,e.next=3,t.paging.next();case 3:b(e.sent);case 5:case"end":return e.stop()}},e)}))).apply(this,arguments)}function b(e){f.trackingEvents=[].concat(_toConsumableArray(f.trackingEvents),_toConsumableArray(e)),t.paging=e.paging,u=o.getPointsFor(f.trackingEvents),v(),t.$apply()}function v(e){n.cancel(p),p=void 0,s=l,f.step=-1,h(),f.step=e?0:u.length-1,k(),f.step=e?0:-1}function h(){f.playing=!1,f.paused=!0}function k(){o.renderPathSnapshot({map:a,layers:c,points:u,step:f.step})}_.assign(f,{$onInit:function(){a=o.createMap(e.find(".tracking-map")[0]),c={marker:o.createDeviceMarker(),path:o.createTrackingPath()}},$onChanges:function(e){e.config&&function(e){var n=_.get(e,"device.id");n&&(f.filter=_objectSpread({},f.filter,{source:n}))}(f.config)},$doCheck:function(){_.isEqual(i,f.filter)||(i=_.cloneDeep(f.filter),g())},$onDestroy:function(){n.cancel(p)},slower:function(){n.cancel(p),p=n(d,s*=2)},faster:function(){n.cancel(p),p=n(d,s/=2)},play:function(){f.paused=!1,f.playing=!0,p||(p=n(d,s))},pause:h,reset:v,stepTo:function(e){h(),f.step=e,k()},step:-1,paused:!0,playing:!1,interval:"days",filter:{dateFrom:moment().subtract(1,"day").format(),dateTo:moment().format()}}),t.paging={},t.loadNext=function(){return m.apply(this,arguments)}}e.$inject=["$element","$interval","$scope","trackingReplayConstants","trackingReplayService"],angular.module("c8y.pocs.trackingReplayWidget").component("c8yTrackingReplayWidget",{templateUrl:":::PLUGIN_PATH:::/widget.html",bindings:{config:"<"},controllerAs:"vm",controller:e})}();