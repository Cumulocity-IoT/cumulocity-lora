"use strict";function _slicedToArray(e,n){return _arrayWithHoles(e)||_iterableToArrayLimit(e,n)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function _iterableToArrayLimit(e,n){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)){var t=[],i=!0,o=!1,a=void 0;try{for(var r,l=e[Symbol.iterator]();!(i=(r=l.next()).done)&&(t.push(r.value),!n||t.length!==n);i=!0);}catch(e){o=!0,a=e}finally{try{i||null==l.return||l.return()}finally{if(o)throw a}}return t}}function _arrayWithHoles(e){if(Array.isArray(e))return e}!function(){function e(e,i,n,o,t,a){i.loading=!1;var r,l={},c=[],m="file-to-large",d="invalid-extension",f={};f[m]=t("Selected file is too large."),f[d]=t("Selected file has invalid extension.");var g={c8y_Global:{}};function s(e){l=e.data,i.imageName=l.name,!(!l.type&&l.dataType)&&c.push(l.id),o.downloadAsDataUri(l).then(function(e){i.imageSrc=e})}function u(e){i.loading=!1,l=e.data,c.push(l.id),i.imageName=l.name,i.config.imageBinaryId=l.id}i.maxFileSizeKB=300,i.invalid=function(e){return i.forms.componentForm[e].$invalid},i.getValidationHints=function(e){var t=[];return i.forms.componentForm[e]&&i.forms.componentForm[e].$error&&_.forEach(i.forms.componentForm[e].$error,function(e,n){e&&t.push(a.getString(f[n]))}),t.join(" ")},i.onNewImageSelected=function(e){var n,t=_slicedToArray(e.target.files,1)[0];return t&&0<t.size&&(-1===t.type.indexOf("image/")?i.forms.componentForm.newImageValidationInput.$setValidity(d,!1):300<t.size/1024?i.forms.componentForm.newImageValidationInput.$setValidity(m,!1):(i.forms.componentForm.newImageValidationInput.$setValidity(m,!0),i.forms.componentForm.newImageValidationInput.$setValidity(d,!0),i.loading=!0,n=o.upload(t,g).then(u))),o.readDataUri(t).then(function(e){i.imageSrc=e}),n},i.$on("cancelWidget",function(){i.config.imageBinaryId=r}),i.$on("$destroy",function(){_.forEach(c,function(e){e!==i.config.imageBinaryId&&o.removeBinary(e)})}),_.isUndefined(i.config.imageBinaryId)||(r=i.config.imageBinaryId,o.detail(i.config.imageBinaryId).then(s))}e.$inject=["$q","$scope","c8yBase","c8yBinary","gettext","gettextCatalog"],angular.module("c8y.parts.imageWidget").controller("imageWidgetConfigCtrl",e)}();