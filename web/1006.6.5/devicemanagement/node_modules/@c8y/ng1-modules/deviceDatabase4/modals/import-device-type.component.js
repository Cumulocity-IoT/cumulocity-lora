"use strict";function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e)){for(var n=0,t=new Array(e.length);n<e.length;n++)t[n]=e[n];return t}}function asyncGeneratorStep(e,n,t,r,i,o,a){try{var c=e[o](a),d=c.value}catch(e){return void t(e)}c.done?n(d):Promise.resolve(d).then(r,i)}function _asyncToGenerator(c){return function(){var e=this,a=arguments;return new Promise(function(n,t){var r=c.apply(e,a);function i(e){asyncGeneratorStep(r,n,t,i,o,"next",e)}function o(e){asyncGeneratorStep(r,n,t,i,o,"throw",e)}i(void 0)})}}!function(){function e(e,a,c,n,t,r,i){var o=this,d={predefined:{info:null,deviceType:null},custom:{file:null,deviceType:null},newName:{value:null,edited:!1}};function u(){return(u=_asyncToGenerator(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=[],e.t1=_toConsumableArray(o.predefinedDeviceTypeInfos),e.t2=_toConsumableArray,e.next=5,c.getPredefinedDeviceTypeInfos();case 5:e.t3=e.sent,e.t4=(0,e.t2)(e.t3),o.predefinedDeviceTypeInfos=e.t0.concat.call(e.t0,e.t1,e.t4),a.$apply();case 9:case"end":return e.stop()}},e)}))).apply(this,arguments)}function l(){return(l=_asyncToGenerator(regeneratorRuntime.mark(function e(n){var t,r,i,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.id,r=n.name,i=n.fieldbusType,p(),e.next=4,c.getPredefinedDeviceType(t);case 4:o=e.sent,f(n,o),s(r,i),a.$apply();case 8:case"end":return e.stop()}},e)}))).apply(this,arguments)}function f(e,n){d.predefined.info=e,d.predefined.deviceType=n}function p(){d.custom.file=null,d.custom.deviceType=null}function s(e,n){d.newName.edited||(d.newName.value=e),d.fieldbusType=n}function y(e){o.customDeviceTypeFeedback=e}_.assign(o,{$onInit:function(){return u.apply(this,arguments)},selection:d,predefinedDeviceTypeInfos:[],downloadPredefinedDeviceType:function(e){return c.downloadPredefinedDeviceTypeAndSaveAs(e.id)},onPredefinedDeviceTypeInfoSelected:function(e){return l.apply(this,arguments)},isPredefinedDeviceTypeInfoSelected:function(e){return d.predefined.info===e},onCustomDeviceTypeFileSelected:function(e){if(!_.isEmpty(e)){var r=_.head(e);y({type:"progress",summary:i.getString("Processing file...")}),n.parseFile(r).then(function(e){var n=e.deviceType,t=e.feedback;d.predefined.info=null,d.predefined.deviceType=null,function(e,n){d.custom.file=e,d.custom.deviceType=n}(r,n),s(n.name,n.fieldbusType),y(t)}).catch(function(e){var n=e.feedback;p(),y(n)})}},onNewNameEdited:function(){d.newName.edited=!0},import:function(){var e=d.predefined,n=d.custom,t=d.newName,r=d.fieldbusType,i=_.cloneDeep(e.deviceType||n.deviceType);i.name=t.value,i.fieldbusType=r,o.close({$value:i})},downloadFileName:c.predefinedDeviceTypeHrefFilename,downloadFileHref:function e(n){var t=e.cache||{};e.cache=t;var r=t[n.id];r||(r=c.downloadPredefinedDeviceTypeHref(n).then(function(e){t[n.id]=e}),t[n.id]=r);return r.then?"":r}})}e.$inject=["$scope","$rootScope","c8yDeviceDatabase","c8yDeviceTypeParser","c8yAlert","gettext","gettextCatalog"],angular.module("c8y.deviceDatabase4").component("c8yImportDeviceTypeModal",{templateUrl:":::PLUGIN_PATH:::/modals/import-device-type.html",bindings:{close:"&",dismiss:"&"},controllerAs:"vm",controller:e})}();