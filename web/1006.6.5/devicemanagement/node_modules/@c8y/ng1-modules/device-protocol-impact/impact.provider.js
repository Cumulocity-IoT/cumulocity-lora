"use strict";!function(){e.$inject=["c8yDeviceProtocolUiProvider","c8yViewsProvider","gettext"];var o="c8yImpact";function e(e,t,m){r.$inject=["c8yApplication","c8yBase","c8yInventory","c8yObjectMappings","c8yModal","c8yAlert","gettextCatalog","$q","$http"],c.$inject=["$routeParams"];var n={service:o,id:"impact",name:m("IMPACT")},h={path:"/deviceprotocols/".concat(n.id,"/:id"),template:'<c8y-impact-detail id="vm.id"></c8y-impact-detail>',controllerAs:"vm",controller:c};return{initUi:function(){e.register(n),t.when(h.path,h)},$get:r};function c(e){_.assign(this,e)}function r(e,r,n,o,c,t,a,i,u){var s,l=r.url("service/impact/"),d="".concat(l,"objectResourceMappings"),p="".concat(d,"/json"),v=[m("BOOLEAN"),m("STRING"),m("INTEGER"),m("FLOAT")];return{showIf:function e(){e.cached||(e.cached=g());return e.cached},isServiceAvailable:g,flow:_.constant(["c8yImpactCreateStep"]),detail:function(e){var t=r.getId(e);return n.detail(t).then(r.getResData)},detailPath:function(e){var t=r.getId(e);return h.path.replace(/:id$/,t)},create:function(e){var t=o.createManagedObject(e);return t.type="impact_object_mapping",u.post(p,t).then(r.getResData)},save:function(e){var t,n=o.fragments.BASE_FRAGMENT,c=_.pick(e,["id",n]);if(!_.get(c,n))throw new Error("c8yImpact.save: ".concat(n," is not defined"));if(_.get(c,"id"))return u.post(p,c).then(r.getResData).then(function(e){return t=e,u.put("".concat(l,"updateAll"))}).then(function(){return t});throw new Error("c8yImpact.save: Id is not defined")},remove:n.remove,removeResourceConfirm:function(t){var e={title:m("Delete resource"),body:a.getString('You are about to delete the resource with the ID "{{id}}". Do you want to proceed?',t),status:"danger",labels:{ok:m("Delete"),cancel:m("Cancel")}};return c(e).then(function(e){return e?t:i.reject()})},overwriteResourceConfirm:function(t){var e={title:m("Overwrite resource"),body:a.getString('You are about to overwrite the resource with the ID "{{id}}". Do you want to proceed?',t),status:"warning",labels:{ok:m("Overwrite"),cancel:m("Cancel")}};return c(e).then(function(e){return e?t:i.reject()})},list:function(){return u.get(d,{silentError:!0}).then(r.getResData)},getName:o.getName,DATA_TYPES:v,alertRemoveResourceSuccess:function(){var e=m("Resource deleted.");t.success(e)},alertUpdateProtocolSuccess:function(){var e=m("Device protocol updated");t.success(e)},listRowInfoComponent:"c8yDeviceProtocolRowCountResources",getCustomActions:function(){s||(s=u.get("".concat(l,"mappingActions/resourceactions")).then(r.getResData).then(f));return s}};function g(){return e.isAvailable({name:"impact",type:"MICROSERVICE"})}function f(e){return _.reduce(e,function(e,t){var n=t.name,c=t.args,r=_.get(c,"length")?c.map(function(e){return"".concat(n,":").concat(e)}):[n];return e.concat(r)},[])}}}angular.module("c8y.impact").provider(o,e)}();