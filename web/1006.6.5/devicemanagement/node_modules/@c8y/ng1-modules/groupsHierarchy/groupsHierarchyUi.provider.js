"use strict";function _toConsumableArray(r){return _arrayWithoutHoles(r)||_iterableToArray(r)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(r){if(Symbol.iterator in Object(r)||"[object Arguments]"===Object.prototype.toString.call(r))return Array.from(r)}function _arrayWithoutHoles(r){if(Array.isArray(r)){for(var t=0,e=new Array(r.length);t<r.length;t++)e[t]=r[t];return e}}function _slicedToArray(r,t){return _arrayWithHoles(r)||_iterableToArrayLimit(r,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function _iterableToArrayLimit(r,t){if(Symbol.iterator in Object(r)||"[object Arguments]"===Object.prototype.toString.call(r)){var e=[],n=!0,o=!1,a=void 0;try{for(var i,c=r[Symbol.iterator]();!(n=(i=c.next()).done)&&(e.push(i.value),!t||e.length!==t);n=!0);}catch(r){o=!0,a=r}finally{try{n||null==c.return||c.return()}finally{if(o)throw a}}return e}}function _arrayWithHoles(r){if(Array.isArray(r))return r}!function(){function r(r,t,e,n,o,a,l){f.$inject=["$routeParams","$injector"];var s,h,p,d,i="/group",c="".concat(i,"/:groupId"),u="/group/:groupId",y={};return{init:function(){t.when(i,{templateUrl:":::PLUGIN_PATH:::/views/groupsList.html",controller:"groupsListCtrl",controllerAs:"vm"}),t.when(c,{name:l("Sub-assets"),icon:"c8y-group-open",templateUrl:":::PLUGIN_PATH:::/views/groupsList.html",controller:"groupsListCtrl",controllerAs:"vm",priority:990}),t.when("/assetsearch",{name:l("Search controller"),icon:"c8y-group-open",templateUrl:":::PLUGIN_PATH:::/views/search.html",controller:"assetSearchCtrl"}),t.when(c,{template:"<div></div>",showIf:function(){return!1}}),r.when("/groups",{redirectTo:"/group"}),r.when("/groups/:path*",{redirectTo:"/group/:path"}),n.addTitle(c,{data:["$routeParams","c8yBase","c8yInventory",function(r,t,e){var n=r.groupId;return n?e.detailCached(n).then(t.getResData).then(function(r){return{title:r.name}}):{}}]}),e.addBreadcrumbs(c,{data:f}),e.addBreadcrumbs(u,{data:f}),o.addGlobalAction({text:l("Add group"),action:["groupsHierarchySvc",function(r){r.addAssetUI()}],showIfPermissions:{anyRole:["ROLE_INVENTORY_ADMIN","ROLE_INVENTORY_CREATE"]}}),a.add({name:l("Search all"),path:function(r){return r&&"/assetsearch?s=".concat(window.encodeURIComponent(r))}})},$get:function(){}};function f(r,t){var e=s=t.get("$q"),n=h=t.get("c8yBase"),o=p=t.get("c8yInventory");d=t.get("c8yGroups");var a,i=e.when([]),c=r.groupId;e.when(null);return c&&(a=o.detail(c,{withParents:!0}).then(n.getResData).then(function(r){return function i(c,u,r){if(!r)return s.when(c);u.unshift((t=r,{icon:d.getIconSpecs(t).iconOpen,groupType:t.type,label:t.name||"".concat(l("Group")," ").concat(t.id),path:"#/group/".concat(t.id)}));var t;return s.all([p.directParentDevices(r),p.directParentAssets(r)]).then(function(r){var t=_slicedToArray(r,2),e=t[0],n=t[1],o=[].concat(_toConsumableArray(e),_toConsumableArray(n)).filter(function(r){var e=r.id;return!u.some(function(r){var t=r.path;return t.includes(e)})}),a=[];return 0===o.length?(c.push(u),s.when(c)):(_.forEach(o,function(r){var t=p.detail(r.id,{withParents:!0}).then(h.getResData).then(function(r){return s.when(i(c,_.cloneDeep(u),r))});a.push(t)}),s.all(a).then(function(){return c}))})}([],[],r)}).then(function(r){var t=r;return _.forEach(t,function(r){r.unshift({label:l("Groups"),icon:"c8y-group-open",path:"#/group",translate:!0})}),t=function(r){return _.sortBy(r,function(r){return-1*r.length})}(t),y[c]=t}),i=e.when(_.get(y,c,a))),i}}r.$inject=["$routeProvider","c8yViewsProvider","c8yBreadcrumbsProvider","c8yTitleProvider","c8yActionsProvider","c8ySearchProvider","gettext"],angular.module("c8y.groupsHierarchy").provider("c8yGroupsHierarchyUi",r)}();