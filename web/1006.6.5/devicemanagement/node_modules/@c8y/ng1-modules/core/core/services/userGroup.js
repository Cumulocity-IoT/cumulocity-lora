"use strict";function _slicedToArray(n,t){return _arrayWithHoles(n)||_iterableToArrayLimit(n,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function _iterableToArrayLimit(n,t){if(Symbol.iterator in Object(n)||"[object Arguments]"===Object.prototype.toString.call(n)){var r=[],e=!0,u=!1,o=void 0;try{for(var c,i=n[Symbol.iterator]();!(e=(c=i.next()).done)&&(r.push(c.value),!t||r.length!==t);e=!0);}catch(n){u=!0,o=n}finally{try{e||null==i.return||i.return()}finally{if(u)throw o}}return r}}function _arrayWithHoles(n){if(Array.isArray(n))return n}!function(){function n(o,c,i,t){var u="user/";function a(){return t.current().then(function(n){var t=n.tenant;return i.url("".concat(u+t,"/groups"))})}function e(n){var r=n.id||n;return t.current().then(function(n){var t=n.tenant;return i.url("".concat(u+t,"/groups/").concat(r))})}function f(n,t){return e(n).then(function(n){return"".concat(n,"/users").concat(t?"/".concat(encodeURIComponent(t.id||t)):"")})}function l(n){return e(n).then(function(n){return"".concat(n,"/roles")})}function s(n){return e(n).then(function(n){return o.get(n)})}function r(t){var r={headers:i.contentHeaders("group")};return e(t).then(function(n){return o.put(n,t,r).then(function(){return t})})}function h(t){var r={headers:i.contentHeaders("group")};return a().then(function(n){return o.post(n,t,r).then(function(n){return s(_slicedToArray(n.headers("location").match(/\d+$/),1)[0]).then(function(n){return n.data})})})}function d(n){var t=i.pageSizeFilter(n),r={params:t},e=i.cleanListCallback("roles",d,t);return c.when(i.url("".concat(u,"roles"))).then(function(n){return o.get(n,r).then(e)})}function p(n,t){return function(n,t){var r=t.id||t;return l(n).then(function(n){return"".concat(n,"/").concat(r)})}(n,t).then(function(n){return o.delete(n)})}return{list:function n(t){var r=i.pageSizeFilter(t),e={params:r},u=i.cleanListCallback("groups",n,r);return a().then(function(n){return o.get(n,e).then(u)})},detail:s,remove:function(n){return e(n).then(function(n){return o.delete(n)})},create:h,update:r,save:function(n){return n.id?r(n):h(n)},listRoles:d,updateGroups:function(t,r){var e=_.get(t,"groups.references",[]).map(function(n){return n.group.id}),u=[];return r.forEach(function(n){-1===e.indexOf(n)&&u.push(function(n,t){var r={user:_.pick(t,["id","self"])};return f(n).then(function(n){return o.post(n,r)})}(n,t))}),e.forEach(function(n){-1===r.indexOf(n)&&u.push(function(n,t){return f(n,t).then(function(n){return o.delete(n)})}(n,t))}),c.all(u)},updateRoles:function(t,r){var e=t.roles.references.map(function(n){return n.role.id}),u=[];return r.forEach(function(n){-1===e.indexOf(n)&&u.push(function(e){return d().then(function(n){var r;return n.forEach(function(n){var t;return n.id===e&&(r=n,t=!1),t}),r})}(n).then(function(n){return function(n,t){var r={headers:i.contentHeaders("roleReference")};return l(n).then(function(n){return o.post(n,{role:t},r)})}(t,n)}))}),e.forEach(function(n){-1===r.indexOf(n)&&u.push(p(t,n))}),c.all(u)}}}n.$inject=["$http","$q","c8yBase","c8yUser"],angular.module("c8y.core").factory("c8yUserGroup",n)}();