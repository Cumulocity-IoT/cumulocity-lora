"use strict";function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function _iterableToArrayLimit(e,t){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)){var n=[],r=!0,i=!1,a=void 0;try{for(var o,c=e[Symbol.iterator]();!(r=(o=c.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){i=!0,a=e}finally{try{r||null==c.return||c.return()}finally{if(i)throw a}}return n}}function _arrayWithHoles(e){if(Array.isArray(e))return e}!function(){function e(p,g,l,d,f,h,m,v,y,b){var w={when:!0,what:!0,who:!0,text:!1,type:!1,time:!1};function A(e){return e.time=moment(e.time).toDate(),e}return{restrict:"EA",link:function(r){function n(e){return"apps/devicemanagement/#/device/".concat(e,"/")}function t(e){return _(_.cloneDeep(e)).map(A).map(o).map(c).map(s).value()}function i(e){e&&(e.map(function(e){return _.assign(e,{showCogWheel:function(){if(_.get(r,"sourceDeviceId")){var e=r.sourceDeviceId,t=_.toNumber(e);if(!_.isNumber(t)||_.isNaN(t))return!0;var n=d.path().match(e);return!(t===_.toNumber(n))}return!0}()})}),r.data=t(e))}function e(e){e&&(r.data=r.data||[],r.data=_.concat(r.data,t(e)),r.paging=e.paging)}function a(){var e=_.clone(r.filter())||{},t={},n=e.source;t.source=_.isObjectLike(n)?n.id:n,delete e.source,_.assign(t,e),t.pageSize=r.pageSize()||100,t.withTotalPages=!0,t.revert=!(!r.reverse||!r.reverse()),h.list(t).then(function(e){return r.paging=e.paging,t.source&&_.remove(e,{activity:"Availability monitoring record"}),e}).then(i)}function o(e){return _.set(e,"_parsedChanges",u(e)),e}function c(e){var t=e.user;if(t){var n=t.match(/\$/);if(_.set(e,"_isSupport",!!n),n&&f.appOption("support_user_string")){var r=_slicedToArray(t.split("$"),2),i=r[0],a=r[1];e.user=y.getString(f.appOption("support_user_string"),{support_user:i,supported_user:a})}}return e}function s(e){var t,n=_.get(e,"source.id"),r="Group"===e.type?"global":"inventory";switch(e.type){case"Alarm":case"Operation":e.sourceInfo={id:n,type:e.type};break;case"CepModule":t="apps/administration/#/eventprocessing";break;case"Tenant":t="apps/administration/#/tenants/".concat(n,"/properties");break;case"Group":case"InventoryRole":t="apps/administration/#/roles/".concat(r,"/").concat(n);break;case"User":var i={id:_.get(e,"source.id",_.get(e,"user"))},a="apps/administration/#/users/".concat(i.id),o="apps/devicemanagement/#/deviceusers/".concat(i.id);t=b.isDeviceUser(i)?o:a;break;case"SmartRule":t="apps/cockpit/#/rules"}return e.sourceLink=t?f.url(t):void 0,e}function u(e){var t=e.changes||[],n=[];return _.forEach(t,function(e){"revision"!==e.attribute&&n.push("".concat(y.getString(p("humanize2")(e.attribute)),": ").concat(y.getString(e.previousValue)," > ").concat(y.getString(e.newValue)))}),n.join(" ; ")}_.assign(r,{goToAuditDetail:function(e){var t=g.when();switch(e.type){case"Alarm":t=m.detail(e.id).then(f.getResData).then(function(e){return"".concat(n(e.source.id),"alarms")});break;case"Operation":t=v.detail(e.id).then(f.getResData).then(function(e){return"".concat(n(e.deviceId),"control")})}t.then(function(e){e&&(l.location=f.url(e))})}}),r.convertType=function(e){return h.types[e]},r.convertTypeIcon=function(e){return h.typeicons[e]||"wrench"},r.refresh=function(){return a()},r.changePage=function(e,t){e!==t&&(r.changeInProgress=!0,r.paging.changePage(e).then(function(e){return r.paging=e.paging,e}).then(i).finally(function(){r.changeInProgress=!1}))},r.loadNext=function(){r.refreshLoading||(r.paging.loading=!0,r.refreshLoading=!0,r.paging.next().then(e).finally(function(){r.paging.loading=!1,r.refreshLoading=!1}))},r.parseChanges=u,r.$watch("filter()",a,!0),r.columnsConfig=_.merge({},w,r.columns())},scope:{filter:"&",data:"=?",reverse:"&",columns:"&",pageSize:"&",paging:"=?",refresh:"=?",borderless:"=?",striped:"=?",sourceDeviceId:"@?"},templateUrl:":::PLUGIN_PATH:::/ui/views/auditList.html"}}e.$inject=["$filter","$q","$window","$location","c8yBase","c8yAudits","c8yAlarms","c8yDeviceControl","gettextCatalog","c8yUser"],angular.module("c8y.ui").directive("c8yAuditList",e)}();