"use strict";function _slicedToArray(t,e){return _arrayWithHoles(t)||_iterableToArrayLimit(t,e)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function _iterableToArrayLimit(t,e){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t)){var r=[],n=!0,a=!1,i=void 0;try{for(var c,o=t[Symbol.iterator]();!(n=(c=o.next()).done)&&(r.push(c.value),!e||r.length!==e);n=!0);}catch(t){a=!0,i=t}finally{try{n||null==o.return||o.return()}finally{if(a)throw i}}return r}}function _arrayWithHoles(t){if(Array.isArray(t))return t}angular.module("c8y.core").directive("c8ySunburstChart",[function(){return{priority:1e3,terminal:!0,restrict:"A",scope:{data:"=chartData"},compile:function(){return function(t,r){var e=_slicedToArray(r,1)[0],n=r.width(),a=n,i=n/2,c=d3.select(e).append("svg").attr("width",n).attr("height",a).append("g").attr("transform","translate(".concat([i,i],")")),o=d3.scale.linear().range([0,2*Math.PI]),l=d3.scale.sqrt().range([0,i]),u=d3.layout.partition().value(function(t){return t.value}),s=d3.svg.arc().startAngle(function(t){return Math.max(0,Math.min(2*Math.PI,o(t.x)))}).endAngle(function(t){return Math.max(0,Math.min(2*Math.PI,o(t.x+t.dx)))}).innerRadius(function(t){return Math.max(0,l(t.y))}).outerRadius(function(t){return Math.max(0,l(t.y+t.dy))});function d(t){var e=t.depth?180*o(t.x+t.dx/2)/Math.PI-90:0;return"rotate(".concat(0+e,")translate(").concat(l(t.y),")rotate(").concat(90<e?-180:0,")")}function f(t){return t.class}function h(t){return t.depth?o(t.x+t.dx/2)>Math.PI?"end":"start":"middle"}function p(t){return t.text?t.text.class:""}t.$watch("data",function(t){if(c.selectAll("*").remove(),_.isObjectLike(t)){r.find("center").remove();var e=u.nodes(t);c.selectAll("*").remove(),c.selectAll("path").data(e).enter().append("path").attr("id",function(t,e){return"path-".concat(e)}).attr("d",s).attr("class",f),c.selectAll("text").data(e).enter().append("text").style("fill-opacity",1).attr("class",p).attr("text-anchor",h).style("font-size",function(t){return t.text?t.text.size:""}).attr("dy",".2em").attr("transform",d).append("tspan").attr("x",0).text(function(t){return t.name?t.name:""})}else r.prepend('<center><i class="icon-spinner icon-spin  icon-3x "></i></center')})}}}}]);