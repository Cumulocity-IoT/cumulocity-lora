"use strict";function _defineProperty(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function _slicedToArray(e,r){return _arrayWithHoles(e)||_iterableToArrayLimit(e,r)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function _iterableToArrayLimit(e,r){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)){var t=[],n=!0,i=!1,a=void 0;try{for(var o,c=e[Symbol.iterator]();!(n=(o=c.next()).done)&&(t.push(o.value),!r||t.length!==r);n=!0);}catch(e){i=!0,a=e}finally{try{n||null==c.return||c.return()}finally{if(i)throw a}}return t}}function _arrayWithHoles(e){if(Array.isArray(e))return e}angular.module("c8y.smartRules").directive("smartRuleParamInputKpi",function(){return{require:"^smartRuleParamInput",scope:{rule:"=",param:"="},restrict:"E",templateUrl:":::PLUGIN_PATH:::/views/paramInputKpi.html",link:function(e,r,t,n){e.placeholder=n.placeholder},controller:["$scope","c8yKpi","c8yDataPointSvc",function(p,e,r){function t(){var e=p.param.property;e&&(p.kpiId=p.rule.config[e])}function n(){var e=p.rule,r=p.param,t=e.config,n=_.get(t,r.property,p.kpiId),i=function(e){return _.find(p.kpis,{id:e})}(n),a=r.mapSelectedKpiToProperties;if(i&&a){var o,c=i.c8y_Kpi;_.assign(t,(_defineProperty(o={},a.fragment,c.fragment),_defineProperty(o,a.series,c.series),_defineProperty(o,a.redRangeMin,_.get(c,"redRangeMin",90)),_defineProperty(o,a.redRangeMax,_.get(c,"redRangeMax",100)),o))}var l=r.property;l&&(t[l]=n)}_.assign(p,{getKpiLabel:function(e){var r=e.c8y_Kpi;return"".concat(r.label," - ").concat(r.series)},openKpiSelector:function(){r.chooseKpiWithUI().then(function(e){var r=_slicedToArray(e,1),t=r[0];p.kpiId=t._kpiId,n()})},onKpiSelectionChange:n}),e.list().then(function(e){p.kpis=e}).then(t)}]}});