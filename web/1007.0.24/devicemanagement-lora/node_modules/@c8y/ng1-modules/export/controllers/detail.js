"use strict";!function(){function e(n,t,e,i,o,a,r,c,s,l,u){var f,d,g,p="exportForm",h={required:s("This field is required."),maxlength:s("Up to 120 characters allowed.")},v=!0,m=!0,x=!1,y=!1;function S(e){n.config=i.create(e),n.filters=i.getFilters(n.config,f&&!d),n.apis=i.getApis(n.config),function(e){i.getSmartRuleDefaults(e).then(function(e){n.smartRuleDefaults=e})}(e),f?d?(delete n.config.id,n.isNew=!0,C(l.getString("Duplicate of {{config}}",{config:n.config.name}))):C(s("Export details")):(n.isNew=!0,C(s("Create configuration"))),n.$watch("apis",function(e,t){_.isEqual(e,t)||n[p].$setDirty()},!0)}function w(){return n.config.apiList=[],n.config.queryParameters={},_.forEach(n.filters,function(e){e.onSave(n.config)}),_.forEach(n.apis,function(e){e.onSave(n.config)}),i.save(n.config)}function C(e){a.changeTitle({title:e})}function R(){return!_.some(n.apis,"enabled")}function E(){!function(){var e="".concat(l.getString("Migrating export schedules...")," ").concat('<div class="c8y-rectangle-spinner spinner-inline"><div class="spinner"><div class="rect1"></div><div class="rect2"></div><div class="rect3"></div><div class="rect4"></div><div class="rect5"></div></div></div>',' <p class="text-normal">').concat(l.getString("Migrating export schedules to the new user interface. Do not close the browser window until the process has been completed."),"</p>");g={text:e,allowHtml:!0,type:"info"},r.add(g),x=!0}(),u.convertToSchedules(f).then(function(){$(!0)}).catch(function(){$(!1)})}function $(e){if(x=!1,e){m=!(v=!(y=!1));var t="".concat(l.getString("Migration complete."),' <p class="text-normal">').concat(l.getString("Smart rule type export schedules were automatically migrated to the new user interface."),"</p>");c(function(){r.update(g,{text:t,type:"success"})},3e3)}else c(function(){r.update(g,{text:s("Export schedules migration failed. Reload to try again."),type:"danger"})},3e3)}_.assign(n,{invalid:o.invalid.bind(o,n,p),validationHints:function(e){return o.validationHints(n[p][e],h)},saveStay:function(){return w().then(function(e){t.path("/export/".concat(e.id))}).then(function(){r.success(s("Configuration saved."))})},saveClose:function(){return w().then(function(){t.path("/export")})},cancel:function(){t.path("/export")},onSelectionChanged:function(e){e.enabled=!0},smartRulesFilter:{ruleTemplateName:"sendExportViaEmail"},reloadSmartRulesList:function(){n.$broadcast("smartRulesListReload")},shouldShowSchedules:function(){return v},migrate:E,onRules:function(e){e&&Array.isArray(e)&&e.length?(y=!(v=!1),E()):m=!1},shouldShowSmartRules:function(){return m},isMigratingWarning:function(){return y&&!x},isMigratingInProgress:function(){return x},disableEditAndCreate:!0}),f=e.exportId,d=!!e.clone,f="new"===f?void 0:f,n.exportTypes=i.getFileTypes(),n.config=i.create(),n.isNoApiChecked=R,f?i.detail(f).then(S):S()}e.$inject=["$scope","$location","$routeParams","exportConfig","c8yBase","c8yTitle","c8yAlert","$timeout","gettext","gettextCatalog","exportService"],angular.module("c8y.cockpit.export").controller("exportConfigDetailCtrl",e)}();