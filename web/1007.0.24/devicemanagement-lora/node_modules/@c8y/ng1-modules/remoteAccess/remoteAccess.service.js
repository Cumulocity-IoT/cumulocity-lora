"use strict";function _objectSpread(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?Object(arguments[e]):{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(e){_defineProperty(t,e,n[e])})}return t}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}!function(){function e(n,a,e,c,r,o,i,s,l,u){var d="service/remoteaccess",t="127.0.0.1",p=":::PLUGIN_PATH:::/clients/terminal/index.html",f="top=30,left=30,height=933,width=1350,location=no,menubar=no,toolbar=no,status=no,resizable=no",v=c.url("".concat(d,"/keypair/generate")),m={http:"ws:",https:"wss:"}[e.protocol()]||"ws:",y="wss:"===m,S="XSRF-TOKEN",P=c.createEnum([{name:"NONE",value:"NONE",label:l("No password")},{name:"USER_PASS",value:"USER_PASS",label:l("Username and password")},{name:"PASS_ONLY",value:"PASS_ONLY",label:l("Password only")},{name:"KEY_PAIR",value:"KEY_PAIR",label:l("Public / private keys")}]),g=c.createEnum([{name:"VNC",value:"VNC",label:l("VNC"),supportedCredentialsTypes:[P.NONE,P.PASS_ONLY],defaults:{host:t,port:5900},clientWindowPath:":::PLUGIN_PATH:::/clients/vnc/vncClient.html",clientWindowParams:"top=0,left=0,location=no,menubar=no,toolbar=no,status=no,resizable=yes",extraConnectionParams:{encrypt:y,true_color:!0,local_cursor:!1,viewport:!0,shared:!0,view_only:!1,disconnectTimeout:10,repeaterID:"",port:443,password:""}},{name:"TELNET",value:"TELNET",label:l("Telnet"),supportedCredentialsTypes:[P.NONE],defaults:{host:t,port:23},clientWindowPath:p,clientWindowParams:f},{name:"SSH",value:"SSH",label:l("SSH"),supportedCredentialsTypes:[P.USER_PASS,P.KEY_PAIR],defaults:{host:t,port:22},clientWindowPath:p,clientWindowParams:f}]);return{DEFAULT_HOST:t,PROTOCOLS:g,CREDENTIALS_TYPES:P,save:function(t,n){try{return function(e,t){var n=_.includes([P.USER_PASS.value,P.PASS_ONLY.value],t.credentialsType),r=_.includes([P.KEY_PAIR.value],t.credentialsType);_.defaults(t,{password:n?_.get(t,"credentials.password"):void 0,privateKey:r?_.get(t,"credentials.privateKey"):void 0}),_.unset(t,"credentials"),_.unset(t,"attrs");var o=b(e,t);return a.put(o,t).then(c.getResData)}(t,n)}catch(e){return function(e,t){var n=h(e);return a.post(n,t).then(c.getResData)}(t,n)}},list:function(e){var t=h(e);return a.get(t).then(c.getResData)},detail:function(e,t){var n=b(e,t);return a.get(n).then(c.getResData)},remove:function(e,t){var n=b(e,t);return a.delete(n)},getConnectionParams:function(e,t){return n.all({title:u.getString("Connected to: {{name}}",t),protocol:_.find(g.values(),{value:t.protocol}),host:i.current().then(function(e){return e.domainName}),path:function(t,n){return o.current().then(function(e){return function(e){var t="service/remoteaccess/client/".concat(e.deviceId,"/configurations/").concat(e.configurationId,"?token=").concat(e.token),n=s.getCookieValue(S);if(n){var r=encodeURIComponent(n);t="".concat(t,"&").concat(S,"=").concat(r)}return t}({deviceId:c.getId(t),configurationId:n.id,token:r.encodeToken(e.userName,r.getPassword(),e.tenant)})})}(e,t),wsProtocol:m}).then(function(e){return _objectSpread({},e,e.protocol.extraConnectionParams)})},isMicroServiceAvailable:_.memoize(function(e){return a.head(h(e),{silentError:!0}).then(_.constant(!0),_.constant(!1))}),parseSshKeyFile:function(r){return n(function(n,e){var t=new FileReader;t.onload=function(e){var t=e.target;return n(t.result)},t.onerror=function(){return e({feedback:{type:"error",summary:l("Could not read file.")}})},t.readAsText(r)})},generateKeys:function(e){return a.post(v,{hostname:e}).then(c.getResData)},exportSshKey:function(e){var t=new Blob([e],{type:"text/plain"});window.saveAs(t,"key.pub")}};function h(e){var t=[d,"devices",c.getId(e),"configurations"].join("/");return c.url(t)}function b(e,t){return[h(e),c.getId(t)].join("/")}}e.$inject=["$q","$http","$location","c8yBase","c8yAuth","c8yUser","c8yTenant","c8yUiUtil","gettext","gettextCatalog"],angular.module("c8y.remoteAccess").factory("c8yRemoteAccess",e)}();