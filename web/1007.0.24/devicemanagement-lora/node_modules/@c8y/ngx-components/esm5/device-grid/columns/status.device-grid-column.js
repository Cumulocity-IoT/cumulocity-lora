import * as tslib_1 from "tslib";
import { BaseDeviceGridColumn } from './base.device-grid-column';
import { StatusCellRendererComponent } from './status.cell-renderer.component';
import { gettext } from '@c8y/ngx-components';
var StatusDeviceGridColumn = /** @class */ (function (_super) {
    tslib_1.__extends(StatusDeviceGridColumn, _super);
    function StatusDeviceGridColumn() {
        var _this = _super.call(this) || this;
        var availabilityStatusPath = 'c8y_Availability.status';
        var requiredAvailabilityPath = 'c8y_RequiredAvailability';
        var connectionStatusPath = 'c8y_Connection.status';
        _this.name = 'status';
        _this.header = gettext('Status');
        _this.dataType = "icon" /* Icon */;
        _this.cellRendererComponent = StatusCellRendererComponent;
        _this.filterable = true;
        _this.filteringConfig = {
            schema: {
                type: 'object',
                properties: {
                    sendOnline: {
                        type: 'boolean'
                    },
                    sendOffline: {
                        type: 'boolean'
                    },
                    sendUnknown: {
                        type: 'boolean'
                    },
                    sendNotMonitored: {
                        type: 'boolean'
                    },
                    pushOnline: {
                        type: 'boolean'
                    },
                    pushOffline: {
                        type: 'boolean'
                    },
                    pushUnknown: {
                        type: 'boolean'
                    },
                    maintenance: {
                        type: 'boolean'
                    }
                }
            },
            form: [
                {
                    type: 'template',
                    template: "<label><span translate>" + gettext('Show devices with send status') + "</span>:</label>"
                },
                {
                    key: 'sendOnline',
                    title: gettext('Online')
                },
                {
                    key: 'sendOffline',
                    title: gettext('Offline')
                },
                {
                    key: 'sendUnknown',
                    title: gettext('Unknown')
                },
                {
                    key: 'sendNotMonitored',
                    title: gettext('Not monitored')
                },
                {
                    type: 'template',
                    template: "<label><span translate>" + gettext('Show devices with push status') + "</span>:</label>"
                },
                {
                    key: 'pushOnline',
                    title: gettext('Online')
                },
                {
                    key: 'pushOffline',
                    title: gettext('Offline')
                },
                {
                    key: 'pushUnknown',
                    title: gettext('Not monitored')
                },
                {
                    type: 'template',
                    template: "<label><span translate>" + gettext('Show devices with maintenance status') + "</span>:</label>"
                },
                {
                    key: 'maintenance',
                    title: gettext('Device is under maintenance')
                }
            ],
            getFilter: function (model) {
                var _a, _b;
                var filter = {};
                var ors = [];
                var sendIns = [];
                var pushIns = [];
                if (model) {
                    if (model.sendOnline) {
                        sendIns.push('AVAILABLE');
                    }
                    if (model.maintenance) {
                        sendIns.push('MAINTENANCE');
                    }
                    if (model.sendOffline) {
                        sendIns.push('UNAVAILABLE');
                    }
                    if (model.sendUnknown) {
                        ors.push({
                            __and: [
                                { __not: { __has: availabilityStatusPath } },
                                { __has: requiredAvailabilityPath }
                            ]
                        });
                    }
                    if (model.sendNotMonitored) {
                        ors.push({
                            __and: [
                                { __not: { __has: availabilityStatusPath } },
                                { __not: { __has: requiredAvailabilityPath } }
                            ]
                        });
                    }
                    if (model.pushOnline) {
                        pushIns.push('CONNECTED');
                    }
                    if (model.pushOffline) {
                        pushIns.push('DISCONNECTED');
                    }
                    if (model.pushUnknown) {
                        ors.push({
                            __not: { __has: connectionStatusPath }
                        });
                    }
                    if (sendIns.length) {
                        ors.push((_a = {}, _a[availabilityStatusPath] = { __in: sendIns }, _a));
                    }
                    if (pushIns.length) {
                        ors.push((_b = {}, _b[connectionStatusPath] = { __in: pushIns }, _b));
                    }
                    if (ors.length) {
                        filter.__or = ors;
                    }
                }
                return filter;
            }
        };
        _this.sortable = true;
        _this.sortingConfig = {
            pathSortingConfigs: [{ path: availabilityStatusPath }]
        };
        return _this;
    }
    return StatusDeviceGridColumn;
}(BaseDeviceGridColumn));
export { StatusDeviceGridColumn };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3RhdHVzLmRldmljZS1ncmlkLWNvbHVtbi5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BjOHkvbmd4LWNvbXBvbmVudHMvZGV2aWNlLWdyaWQvIiwic291cmNlcyI6WyJjb2x1bW5zL3N0YXR1cy5kZXZpY2UtZ3JpZC1jb2x1bW4udHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFBRSxvQkFBb0IsRUFBRSxNQUFNLDJCQUEyQixDQUFDO0FBQ2pFLE9BQU8sRUFBRSwyQkFBMkIsRUFBRSxNQUFNLGtDQUFrQyxDQUFDO0FBRS9FLE9BQU8sRUFBRSxPQUFPLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUU5QztJQUE0QyxrREFBb0I7SUFDOUQ7UUFBQSxZQUNFLGlCQUFPLFNBMkpSO1FBekpDLElBQU0sc0JBQXNCLEdBQUcseUJBQXlCLENBQUM7UUFDekQsSUFBTSx3QkFBd0IsR0FBRywwQkFBMEIsQ0FBQztRQUM1RCxJQUFNLG9CQUFvQixHQUFHLHVCQUF1QixDQUFDO1FBRXJELEtBQUksQ0FBQyxJQUFJLEdBQUcsUUFBUSxDQUFDO1FBQ3JCLEtBQUksQ0FBQyxNQUFNLEdBQUcsT0FBTyxDQUFDLFFBQVEsQ0FBQyxDQUFDO1FBQ2hDLEtBQUksQ0FBQyxRQUFRLG9CQUFzQixDQUFDO1FBQ3BDLEtBQUksQ0FBQyxxQkFBcUIsR0FBRywyQkFBMkIsQ0FBQztRQUV6RCxLQUFJLENBQUMsVUFBVSxHQUFHLElBQUksQ0FBQztRQUN2QixLQUFJLENBQUMsZUFBZSxHQUFHO1lBQ3JCLE1BQU0sRUFBRTtnQkFDTixJQUFJLEVBQUUsUUFBUTtnQkFDZCxVQUFVLEVBQUU7b0JBQ1YsVUFBVSxFQUFFO3dCQUNWLElBQUksRUFBRSxTQUFTO3FCQUNoQjtvQkFDRCxXQUFXLEVBQUU7d0JBQ1gsSUFBSSxFQUFFLFNBQVM7cUJBQ2hCO29CQUNELFdBQVcsRUFBRTt3QkFDWCxJQUFJLEVBQUUsU0FBUztxQkFDaEI7b0JBQ0QsZ0JBQWdCLEVBQUU7d0JBQ2hCLElBQUks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Si9EIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQmFzZURldmljZUdyaWRDb2x1bW4gfSBmcm9tICcuL2Jhc2UuZGV2aWNlLWdyaWQtY29sdW1uJztcbmltcG9ydCB7IFN0YXR1c0NlbGxSZW5kZXJlckNvbXBvbmVudCB9IGZyb20gJy4vc3RhdHVzLmNlbGwtcmVuZGVyZXIuY29tcG9uZW50JztcbmltcG9ydCB7IENvbHVtbkRhdGFUeXBlIH0gZnJvbSAnQGM4eS9uZ3gtY29tcG9uZW50cyc7XG5pbXBvcnQgeyBnZXR0ZXh0IH0gZnJvbSAnQGM4eS9uZ3gtY29tcG9uZW50cyc7XG5cbmV4cG9ydCBjbGFzcyBTdGF0dXNEZXZpY2VHcmlkQ29sdW1uIGV4dGVuZHMgQmFzZURldmljZUdyaWRDb2x1bW4ge1xuICBjb25zdHJ1Y3RvcigpIHtcbiAgICBzdXBlcigpO1xuXG4gICAgY29uc3QgYXZhaWxhYmlsaXR5U3RhdHVzUGF0aCA9ICdjOHlfQXZhaWxhYmlsaXR5LnN0YXR1cyc7XG4gICAgY29uc3QgcmVxdWlyZWRBdmFpbGFiaWxpdHlQYXRoID0gJ2M4eV9SZXF1aXJlZEF2YWlsYWJpbGl0eSc7XG4gICAgY29uc3QgY29ubmVjdGlvblN0YXR1c1BhdGggPSAnYzh5X0Nvbm5lY3Rpb24uc3RhdHVzJztcblxuICAgIHRoaXMubmFtZSA9ICdzdGF0dXMnO1xuICAgIHRoaXMuaGVhZGVyID0gZ2V0dGV4dCgnU3RhdHVzJyk7XG4gICAgdGhpcy5kYXRhVHlwZSA9IENvbHVtbkRhdGFUeXBlLkljb247XG4gICAgdGhpcy5jZWxsUmVuZGVyZXJDb21wb25lbnQgPSBTdGF0dXNDZWxsUmVuZGVyZXJDb21wb25lbnQ7XG5cbiAgICB0aGlzLmZpbHRlcmFibGUgPSB0cnVlO1xuICAgIHRoaXMuZmlsdGVyaW5nQ29uZmlnID0ge1xuICAgICAgc2NoZW1hOiB7XG4gICAgICAgIHR5cGU6ICdvYmplY3QnLFxuICAgICAgICBwcm9wZXJ0aWVzOiB7XG4gICAgICAgICAgc2VuZE9ubGluZToge1xuICAgICAgICAgICAgdHlwZTogJ2Jvb2xlYW4nXG4gICAgICAgICAgfSxcbiAgICAgICAgICBzZW5kT2ZmbGluZToge1xuICAgICAgICAgICAgdHlwZTogJ2Jvb2xlYW4nXG4gICAgICAgICAgfSxcbiAgICAgICAgICBzZW5kVW5rbm93bjoge1xuICAgICAgICAgICAgdHlwZTogJ2Jvb2xlYW4nXG4gICAgICAgICAgfSxcbiAgICAgICAgICBzZW5kTm90TW9uaXRvcmVkOiB7XG4gICAgICAgICAgICB0eXBlOiAnYm9vbGVhbidcbiAgICAgICAgICB9LFxuICAgICAgICAgIHB1c2hPbmxpbmU6IHtcbiAgICAgICAgICAgIHR5cGU6ICdib29sZWFuJ1xuICAgICAgICAgIH0sXG4gICAgICAgICAgcHVzaE9mZmxpbmU6IHtcbiAgICAgICAgICAgIHR5cGU6ICdib29sZWFuJ1xuICAgICAgICAgIH0sXG4gICAgICAgICAgcHVzaFVua25vd246IHtcbiAgICAgICAgICAgIHR5cGU6ICdib29sZWFuJ1xuICAgICAgICAgIH0sXG4gICAgICAgICAgbWFpbnRlbmFuY2U6IHtcbiAgICAgICAgICAgIHR5cGU6ICdib29sZWFuJ1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIGZvcm06IFtcbiAgICAgICAge1xuICAgICAgICAgIHR5cGU6ICd0ZW1wbGF0ZScsXG4gICAgICAgICAgdGVtcGxhdGU6IGA8bGFiZWw+PHNwYW4gdHJhbnNsYXRlPiR7Z2V0dGV4dChcbiAgICAgICAgICAgICdTaG93IGRldmljZXMgd2l0aCBzZW5kIHN0YXR1cydcbiAgICAgICAgICApfTwvc3Bhbj46PC9sYWJlbD5gXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBrZXk6ICdzZW5kT25saW5lJyxcbiAgICAgICAgICB0aXRsZTogZ2V0dGV4dCgnT25saW5lJylcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIGtleTogJ3NlbmRPZmZsaW5lJyxcbiAgICAgICAgICB0aXRsZTogZ2V0dGV4dCgnT2ZmbGluZScpXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBrZXk6ICdzZW5kVW5rbm93bicsXG4gICAgICAgICAgdGl0bGU6IGdldHRleHQoJ1Vua25vd24nKVxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAga2V5OiAnc2VuZE5vdE1vbml0b3JlZCcsXG4gICAgICAgICAgdGl0bGU6IGdldHRleHQoJ05vdCBtb25pdG9yZWQnKVxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgdHlwZTogJ3RlbXBsYXRlJyxcbiAgICAgICAgICB0ZW1wbGF0ZTogYDxsYWJlbD48c3BhbiB0cmFuc2xhdGU+JHtnZXR0ZXh0KFxuICAgICAgICAgICAgJ1Nob3cgZGV2aWNlcyB3aXRoIHB1c2ggc3RhdHVzJ1xuICAgICAgICAgICl9PC9zcGFuPjo8L2xhYmVsPmBcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIGtleTogJ3B1c2hPbmxpbmUnLFxuICAgICAgICAgIHRpdGxlOiBnZXR0ZXh0KCdPbmxpbmUnKVxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAga2V5OiAncHVzaE9mZmxpbmUnLFxuICAgICAgICAgIHRpdGxlOiBnZXR0ZXh0KCdPZmZsaW5lJylcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIGtleTogJ3B1c2hVbmtub3duJyxcbiAgICAgICAgICB0aXRsZTogZ2V0dGV4dCgnTm90IG1vbml0b3JlZCcpXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICB0eXBlOiAndGVtcGxhdGUnLFxuICAgICAgICAgIHRlbXBsYXRlOiBgPGxhYmVsPjxzcGFuIHRyYW5zbGF0ZT4ke2dldHRleHQoXG4gICAgICAgICAgICAnU2hvdyBkZXZpY2VzIHdpdGggbWFpbnRlbmFuY2Ugc3RhdHVzJ1xuICAgICAgICAgICl9PC9zcGFuPjo8L2xhYmVsPmBcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIGtleTogJ21haW50ZW5hbmNlJyxcbiAgICAgICAgICB0aXRsZTogZ2V0dGV4dCgnRGV2aWNlIGlzIHVuZGVyIG1haW50ZW5hbmNlJylcbiAgICAgICAgfVxuICAgICAgXSxcbiAgICAgIGdldEZpbHRlcihtb2RlbCkge1xuICAgICAgICBjb25zdCBmaWx0ZXI6IGFueSA9IHt9O1xuICAgICAgICBjb25zdCBvcnMgPSBbXTtcbiAgICAgICAgY29uc3Qgc2VuZElucyA9IFtdO1xuICAgICAgICBjb25zdCBwdXNoSW5zID0gW107XG4gICAgICAgIGlmIChtb2RlbCkge1xuICAgICAgICAgIGlmIChtb2RlbC5zZW5kT25saW5lKSB7XG4gICAgICAgICAgICBzZW5kSW5zLnB1c2goJ0FWQUlMQUJMRScpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAobW9kZWwubWFpbnRlbmFuY2UpIHtcbiAgICAgICAgICAgIHNlbmRJbnMucHVzaCgnTUFJTlRFTkFOQ0UnKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKG1vZGVsLnNlbmRPZmZsaW5lKSB7XG4gICAgICAgICAgICBzZW5kSW5zLnB1c2goJ1VOQVZBSUxBQkxFJyk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChtb2RlbC5zZW5kVW5rbm93bikge1xuICAgICAgICAgICAgb3JzLnB1c2goe1xuICAgICAgICAgICAgICBfX2FuZDogW1xuICAgICAgICAgICAgICAgIHsgX19ub3Q6IHsgX19oYXM6IGF2YWlsYWJpbGl0eVN0YXR1c1BhdGggfSB9LFxuICAgICAgICAgICAgICAgIHsgX19oYXM6IHJlcXVpcmVkQXZhaWxhYmlsaXR5UGF0aCB9XG4gICAgICAgICAgICAgIF1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAobW9kZWwuc2VuZE5vdE1vbml0b3JlZCkge1xuICAgICAgICAgICAgb3JzLnB1c2goe1xuICAgICAgICAgICAgICBfX2FuZDogW1xuICAgICAgICAgICAgICAgIHsgX19ub3Q6IHsgX19oYXM6IGF2YWlsYWJpbGl0eVN0YXR1c1BhdGggfSB9LFxuICAgICAgICAgICAgICAgIHsgX19ub3Q6IHsgX19oYXM6IHJlcXVpcmVkQXZhaWxhYmlsaXR5UGF0aCB9IH1cbiAgICAgICAgICAgICAgXVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgaWYgKG1vZGVsLnB1c2hPbmxpbmUpIHtcbiAgICAgICAgICAgIHB1c2hJbnMucHVzaCgnQ09OTkVDVEVEJyk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChtb2RlbC5wdXNoT2ZmbGluZSkge1xuICAgICAgICAgICAgcHVzaElucy5wdXNoKCdESVNDT05ORUNURUQnKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKG1vZGVsLnB1c2hVbmtub3duKSB7XG4gICAgICAgICAgICBvcnMucHVzaCh7XG4gICAgICAgICAgICAgIF9fbm90OiB7IF9faGFzOiBjb25uZWN0aW9uU3RhdHVzUGF0aCB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKHNlbmRJbnMubGVuZ3RoKSB7XG4gICAgICAgICAgICBvcnMucHVzaCh7IFthdmFpbGFiaWxpdHlTdGF0dXNQYXRoXTogeyBfX2luOiBzZW5kSW5zIH0gfSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChwdXNoSW5zLmxlbmd0aCkge1xuICAgICAgICAgICAgb3JzLnB1c2goeyBbY29ubmVjdGlvblN0YXR1c1BhdGhdOiB7IF9faW46IHB1c2hJbnMgfSB9KTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKG9ycy5sZW5ndGgpIHtcbiAgICAgICAgICAgIGZpbHRlci5fX29yID0gb3JzO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZmlsdGVyO1xuICAgICAgfVxuICAgIH07XG5cbiAgICB0aGlzLnNvcnRhYmxlID0gdHJ1ZTtcbiAgICB0aGlzLnNvcnRpbmdDb25maWcgPSB7XG4gICAgICBwYXRoU29ydGluZ0NvbmZpZ3M6IFt7IHBhdGg6IGF2YWlsYWJpbGl0eVN0YXR1c1BhdGggfV1cbiAgICB9O1xuICB9XG59XG4iXX0=