import { BaseDeviceGridColumn } from './base.device-grid-column';
import { StatusCellRendererComponent } from './status.cell-renderer.component';
import { gettext } from '@c8y/ngx-components';
export class StatusDeviceGridColumn extends BaseDeviceGridColumn {
    constructor() {
        super();
        const availabilityStatusPath = 'c8y_Availability.status';
        const requiredAvailabilityPath = 'c8y_RequiredAvailability';
        const connectionStatusPath = 'c8y_Connection.status';
        this.name = 'status';
        this.header = gettext('Status');
        this.dataType = "icon" /* Icon */;
        this.cellRendererComponent = StatusCellRendererComponent;
        this.filterable = true;
        this.filteringConfig = {
            schema: {
                type: 'object',
                properties: {
                    sendOnline: {
                        type: 'boolean'
                    },
                    sendOffline: {
                        type: 'boolean'
                    },
                    sendUnknown: {
                        type: 'boolean'
                    },
                    sendNotMonitored: {
                        type: 'boolean'
                    },
                    pushOnline: {
                        type: 'boolean'
                    },
                    pushOffline: {
                        type: 'boolean'
                    },
                    pushUnknown: {
                        type: 'boolean'
                    },
                    maintenance: {
                        type: 'boolean'
                    }
                }
            },
            form: [
                {
                    type: 'template',
                    template: `<label><span translate>${gettext('Show devices with send status')}</span>:</label>`
                },
                {
                    key: 'sendOnline',
                    title: gettext('Online')
                },
                {
                    key: 'sendOffline',
                    title: gettext('Offline')
                },
                {
                    key: 'sendUnknown',
                    title: gettext('Unknown')
                },
                {
                    key: 'sendNotMonitored',
                    title: gettext('Not monitored')
                },
                {
                    type: 'template',
                    template: `<label><span translate>${gettext('Show devices with push status')}</span>:</label>`
                },
                {
                    key: 'pushOnline',
                    title: gettext('Online')
                },
                {
                    key: 'pushOffline',
                    title: gettext('Offline')
                },
                {
                    key: 'pushUnknown',
                    title: gettext('Not monitored')
                },
                {
                    type: 'template',
                    template: `<label><span translate>${gettext('Show devices with maintenance status')}</span>:</label>`
                },
                {
                    key: 'maintenance',
                    title: gettext('Device is under maintenance')
                }
            ],
            getFilter(model) {
                const filter = {};
                const ors = [];
                const sendIns = [];
                const pushIns = [];
                if (model) {
                    if (model.sendOnline) {
                        sendIns.push('AVAILABLE');
                    }
                    if (model.maintenance) {
                        sendIns.push('MAINTENANCE');
                    }
                    if (model.sendOffline) {
                        sendIns.push('UNAVAILABLE');
                    }
                    if (model.sendUnknown) {
                        ors.push({
                            __and: [
                                { __not: { __has: availabilityStatusPath } },
                                { __has: requiredAvailabilityPath }
                            ]
                        });
                    }
                    if (model.sendNotMonitored) {
                        ors.push({
                            __and: [
                                { __not: { __has: availabilityStatusPath } },
                                { __not: { __has: requiredAvailabilityPath } }
                            ]
                        });
                    }
                    if (model.pushOnline) {
                        pushIns.push('CONNECTED');
                    }
                    if (model.pushOffline) {
                        pushIns.push('DISCONNECTED');
                    }
                    if (model.pushUnknown) {
                        ors.push({
                            __not: { __has: connectionStatusPath }
                        });
                    }
                    if (sendIns.length) {
                        ors.push({ [availabilityStatusPath]: { __in: sendIns } });
                    }
                    if (pushIns.length) {
                        ors.push({ [connectionStatusPath]: { __in: pushIns } });
                    }
                    if (ors.length) {
                        filter.__or = ors;
                    }
                }
                return filter;
            }
        };
        this.sortable = true;
        this.sortingConfig = {
            pathSortingConfigs: [{ path: availabilityStatusPath }]
        };
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3RhdHVzLmRldmljZS1ncmlkLWNvbHVtbi5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BjOHkvbmd4LWNvbXBvbmVudHMvZGV2aWNlLWdyaWQvIiwic291cmNlcyI6WyJjb2x1bW5zL3N0YXR1cy5kZXZpY2UtZ3JpZC1jb2x1bW4udHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLG9CQUFvQixFQUFFLE1BQU0sMkJBQTJCLENBQUM7QUFDakUsT0FBTyxFQUFFLDJCQUEyQixFQUFFLE1BQU0sa0NBQWtDLENBQUM7QUFFL0UsT0FBTyxFQUFFLE9BQU8sRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBRTlDLE1BQU0sT0FBTyxzQkFBdUIsU0FBUSxvQkFBb0I7SUFDOUQ7UUFDRSxLQUFLLEVBQUUsQ0FBQztRQUVSLE1BQU0sc0JBQXNCLEdBQUcseUJBQXlCLENBQUM7UUFDekQsTUFBTSx3QkFBd0IsR0FBRywwQkFBMEIsQ0FBQztRQUM1RCxNQUFNLG9CQUFvQixHQUFHLHVCQUF1QixDQUFDO1FBRXJELElBQUksQ0FBQyxJQUFJLEdBQUcsUUFBUSxDQUFDO1FBQ3JCLElBQUksQ0FBQyxNQUFNLEdBQUcsT0FBTyxDQUFDLFFBQVEsQ0FBQyxDQUFDO1FBQ2hDLElBQUksQ0FBQyxRQUFRLG9CQUFzQixDQUFDO1FBQ3BDLElBQUksQ0FBQyxxQkFBcUIsR0FBRywyQkFBMkIsQ0FBQztRQUV6RCxJQUFJLENBQUMsVUFBVSxHQUFHLElBQUksQ0FBQztRQUN2QixJQUFJLENBQUMsZUFBZSxHQUFHO1lBQ3JCLE1BQU0sRUFBRTtnQkFDTixJQUFJLEVBQUUsUUFBUTtnQkFDZCxVQUFVLEVBQUU7b0JBQ1YsVUFBVSxFQUFFO3dCQUNWLElBQUksRUFBRSxTQUFTO3FCQUNoQjtvQkFDRCxXQUFXLEVBQUU7d0JBQ1gsSUFBSSxFQUFFLFNBQVM7cUJBQ2hCO29CQUNELFdBQVcsRUFBRTt3QkFDWCxJQUFJLEVBQUUsU0FBUztxQkFDaEI7b0JBQ0QsZ0JBQWdCLEVBQUU7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b3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBCYXNlRGV2aWNlR3JpZENvbHVtbiB9IGZyb20gJy4vYmFzZS5kZXZpY2UtZ3JpZC1jb2x1bW4nO1xuaW1wb3J0IHsgU3RhdHVzQ2VsbFJlbmRlcmVyQ29tcG9uZW50IH0gZnJvbSAnLi9zdGF0dXMuY2VsbC1yZW5kZXJlci5jb21wb25lbnQnO1xuaW1wb3J0IHsgQ29sdW1uRGF0YVR5cGUgfSBmcm9tICdAYzh5L25neC1jb21wb25lbnRzJztcbmltcG9ydCB7IGdldHRleHQgfSBmcm9tICdAYzh5L25neC1jb21wb25lbnRzJztcblxuZXhwb3J0IGNsYXNzIFN0YXR1c0RldmljZUdyaWRDb2x1bW4gZXh0ZW5kcyBCYXNlRGV2aWNlR3JpZENvbHVtbiB7XG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIHN1cGVyKCk7XG5cbiAgICBjb25zdCBhdmFpbGFiaWxpdHlTdGF0dXNQYXRoID0gJ2M4eV9BdmFpbGFiaWxpdHkuc3RhdHVzJztcbiAgICBjb25zdCByZXF1aXJlZEF2YWlsYWJpbGl0eVBhdGggPSAnYzh5X1JlcXVpcmVkQXZhaWxhYmlsaXR5JztcbiAgICBjb25zdCBjb25uZWN0aW9uU3RhdHVzUGF0aCA9ICdjOHlfQ29ubmVjdGlvbi5zdGF0dXMnO1xuXG4gICAgdGhpcy5uYW1lID0gJ3N0YXR1cyc7XG4gICAgdGhpcy5oZWFkZXIgPSBnZXR0ZXh0KCdTdGF0dXMnKTtcbiAgICB0aGlzLmRhdGFUeXBlID0gQ29sdW1uRGF0YVR5cGUuSWNvbjtcbiAgICB0aGlzLmNlbGxSZW5kZXJlckNvbXBvbmVudCA9IFN0YXR1c0NlbGxSZW5kZXJlckNvbXBvbmVudDtcblxuICAgIHRoaXMuZmlsdGVyYWJsZSA9IHRydWU7XG4gICAgdGhpcy5maWx0ZXJpbmdDb25maWcgPSB7XG4gICAgICBzY2hlbWE6IHtcbiAgICAgICAgdHlwZTogJ29iamVjdCcsXG4gICAgICAgIHByb3BlcnRpZXM6IHtcbiAgICAgICAgICBzZW5kT25saW5lOiB7XG4gICAgICAgICAgICB0eXBlOiAnYm9vbGVhbidcbiAgICAgICAgICB9LFxuICAgICAgICAgIHNlbmRPZmZsaW5lOiB7XG4gICAgICAgICAgICB0eXBlOiAnYm9vbGVhbidcbiAgICAgICAgICB9LFxuICAgICAgICAgIHNlbmRVbmtub3duOiB7XG4gICAgICAgICAgICB0eXBlOiAnYm9vbGVhbidcbiAgICAgICAgICB9LFxuICAgICAgICAgIHNlbmROb3RNb25pdG9yZWQ6IHtcbiAgICAgICAgICAgIHR5cGU6ICdib29sZWFuJ1xuICAgICAgICAgIH0sXG4gICAgICAgICAgcHVzaE9ubGluZToge1xuICAgICAgICAgICAgdHlwZTogJ2Jvb2xlYW4nXG4gICAgICAgICAgfSxcbiAgICAgICAgICBwdXNoT2ZmbGluZToge1xuICAgICAgICAgICAgdHlwZTogJ2Jvb2xlYW4nXG4gICAgICAgICAgfSxcbiAgICAgICAgICBwdXNoVW5rbm93bjoge1xuICAgICAgICAgICAgdHlwZTogJ2Jvb2xlYW4nXG4gICAgICAgICAgfSxcbiAgICAgICAgICBtYWludGVuYW5jZToge1xuICAgICAgICAgICAgdHlwZTogJ2Jvb2xlYW4nXG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgZm9ybTogW1xuICAgICAgICB7XG4gICAgICAgICAgdHlwZTogJ3RlbXBsYXRlJyxcbiAgICAgICAgICB0ZW1wbGF0ZTogYDxsYWJlbD48c3BhbiB0cmFuc2xhdGU+JHtnZXR0ZXh0KFxuICAgICAgICAgICAgJ1Nob3cgZGV2aWNlcyB3aXRoIHNlbmQgc3RhdHVzJ1xuICAgICAgICAgICl9PC9zcGFuPjo8L2xhYmVsPmBcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIGtleTogJ3NlbmRPbmxpbmUnLFxuICAgICAgICAgIHRpdGxlOiBnZXR0ZXh0KCdPbmxpbmUnKVxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAga2V5OiAnc2VuZE9mZmxpbmUnLFxuICAgICAgICAgIHRpdGxlOiBnZXR0ZXh0KCdPZmZsaW5lJylcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIGtleTogJ3NlbmRVbmtub3duJyxcbiAgICAgICAgICB0aXRsZTogZ2V0dGV4dCgnVW5rbm93bicpXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBrZXk6ICdzZW5kTm90TW9uaXRvcmVkJyxcbiAgICAgICAgICB0aXRsZTogZ2V0dGV4dCgnTm90IG1vbml0b3JlZCcpXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICB0eXBlOiAndGVtcGxhdGUnLFxuICAgICAgICAgIHRlbXBsYXRlOiBgPGxhYmVsPjxzcGFuIHRyYW5zbGF0ZT4ke2dldHRleHQoXG4gICAgICAgICAgICAnU2hvdyBkZXZpY2VzIHdpdGggcHVzaCBzdGF0dXMnXG4gICAgICAgICAgKX08L3NwYW4+OjwvbGFiZWw+YFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAga2V5OiAncHVzaE9ubGluZScsXG4gICAgICAgICAgdGl0bGU6IGdldHRleHQoJ09ubGluZScpXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBrZXk6ICdwdXNoT2ZmbGluZScsXG4gICAgICAgICAgdGl0bGU6IGdldHRleHQoJ09mZmxpbmUnKVxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAga2V5OiAncHVzaFVua25vd24nLFxuICAgICAgICAgIHRpdGxlOiBnZXR0ZXh0KCdOb3QgbW9uaXRvcmVkJylcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIHR5cGU6ICd0ZW1wbGF0ZScsXG4gICAgICAgICAgdGVtcGxhdGU6IGA8bGFiZWw+PHNwYW4gdHJhbnNsYXRlPiR7Z2V0dGV4dChcbiAgICAgICAgICAgICdTaG93IGRldmljZXMgd2l0aCBtYWludGVuYW5jZSBzdGF0dXMnXG4gICAgICAgICAgKX08L3NwYW4+OjwvbGFiZWw+YFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAga2V5OiAnbWFpbnRlbmFuY2UnLFxuICAgICAgICAgIHRpdGxlOiBnZXR0ZXh0KCdEZXZpY2UgaXMgdW5kZXIgbWFpbnRlbmFuY2UnKVxuICAgICAgICB9XG4gICAgICBdLFxuICAgICAgZ2V0RmlsdGVyKG1vZGVsKSB7XG4gICAgICAgIGNvbnN0IGZpbHRlcjogYW55ID0ge307XG4gICAgICAgIGNvbnN0IG9ycyA9IFtdO1xuICAgICAgICBjb25zdCBzZW5kSW5zID0gW107XG4gICAgICAgIGNvbnN0IHB1c2hJbnMgPSBbXTtcbiAgICAgICAgaWYgKG1vZGVsKSB7XG4gICAgICAgICAgaWYgKG1vZGVsLnNlbmRPbmxpbmUpIHtcbiAgICAgICAgICAgIHNlbmRJbnMucHVzaCgnQVZBSUxBQkxFJyk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChtb2RlbC5tYWludGVuYW5jZSkge1xuICAgICAgICAgICAgc2VuZElucy5wdXNoKCdNQUlOVEVOQU5DRScpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAobW9kZWwuc2VuZE9mZmxpbmUpIHtcbiAgICAgICAgICAgIHNlbmRJbnMucHVzaCgnVU5BVkFJTEFCTEUnKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKG1vZGVsLnNlbmRVbmtub3duKSB7XG4gICAgICAgICAgICBvcnMucHVzaCh7XG4gICAgICAgICAgICAgIF9fYW5kOiBbXG4gICAgICAgICAgICAgICAgeyBfX25vdDogeyBfX2hhczogYXZhaWxhYmlsaXR5U3RhdHVzUGF0aCB9IH0sXG4gICAgICAgICAgICAgICAgeyBfX2hhczogcmVxdWlyZWRBdmFpbGFiaWxpdHlQYXRoIH1cbiAgICAgICAgICAgICAgXVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChtb2RlbC5zZW5kTm90TW9uaXRvcmVkKSB7XG4gICAgICAgICAgICBvcnMucHVzaCh7XG4gICAgICAgICAgICAgIF9fYW5kOiBbXG4gICAgICAgICAgICAgICAgeyBfX25vdDogeyBfX2hhczogYXZhaWxhYmlsaXR5U3RhdHVzUGF0aCB9IH0sXG4gICAgICAgICAgICAgICAgeyBfX25vdDogeyBfX2hhczogcmVxdWlyZWRBdmFpbGFiaWxpdHlQYXRoIH0gfVxuICAgICAgICAgICAgICBdXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBpZiAobW9kZWwucHVzaE9ubGluZSkge1xuICAgICAgICAgICAgcHVzaElucy5wdXNoKCdDT05ORUNURUQnKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKG1vZGVsLnB1c2hPZmZsaW5lKSB7XG4gICAgICAgICAgICBwdXNoSW5zLnB1c2goJ0RJU0NPTk5FQ1RFRCcpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAobW9kZWwucHVzaFVua25vd24pIHtcbiAgICAgICAgICAgIG9ycy5wdXNoKHtcbiAgICAgICAgICAgICAgX19ub3Q6IHsgX19oYXM6IGNvbm5lY3Rpb25TdGF0dXNQYXRoIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAoc2VuZElucy5sZW5ndGgpIHtcbiAgICAgICAgICAgIG9ycy5wdXNoKHsgW2F2YWlsYWJpbGl0eVN0YXR1c1BhdGhdOiB7IF9faW46IHNlbmRJbnMgfSB9KTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKHB1c2hJbnMubGVuZ3RoKSB7XG4gICAgICAgICAgICBvcnMucHVzaCh7IFtjb25uZWN0aW9uU3RhdHVzUGF0aF06IHsgX19pbjogcHVzaElucyB9IH0pO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAob3JzLmxlbmd0aCkge1xuICAgICAgICAgICAgZmlsdGVyLl9fb3IgPSBvcnM7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmaWx0ZXI7XG4gICAgICB9XG4gICAgfTtcblxuICAgIHRoaXMuc29ydGFibGUgPSB0cnVlO1xuICAgIHRoaXMuc29ydGluZ0NvbmZpZyA9IHtcbiAgICAgIHBhdGhTb3J0aW5nQ29uZmlnczogW3sgcGF0aDogYXZhaWxhYmlsaXR5U3RhdHVzUGF0aCB9XVxuICAgIH07XG4gIH1cbn1cbiJdfQ==