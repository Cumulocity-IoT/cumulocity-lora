import * as tslib_1 from "tslib";
import { Component, Output, Input, EventEmitter } from '@angular/core';
import { BehaviorSubject } from 'rxjs';
import { map } from 'rxjs/operators';
import { filter } from 'lodash-es';
let DeviceSoftwareChangesComponent = class DeviceSoftwareChangesComponent {
    constructor() {
        this.clear = new EventEmitter();
        this.apply = new EventEmitter();
        this.changes$ = new BehaviorSubject([]);
        this.installations$ = this.changes$.pipe(map(changes => {
            return filter(changes, change => {
                const { name, action } = change;
                const relatedChanges = filter(changes, { name });
                return action === 'install' && relatedChanges.length === 1;
            });
        }));
        this.updates$ = this.changes$.pipe(map(changes => {
            return filter(changes, change => {
                const { name, action } = change;
                const relatedChanges = filter(changes, { name });
                return action === 'install' && relatedChanges.length === 2;
            });
        }));
        this.removals$ = this.changes$.pipe(map(changes => {
            return filter(changes, change => {
                const { name, action } = change;
                const relatedChanges = filter(changes, { name });
                return action === 'delete' && relatedChanges.length === 1;
            });
        }));
    }
    ngOnChanges(changes) {
        if (changes.changes) {
            this.changes$.next(changes.changes.currentValue);
        }
    }
};
tslib_1.__decorate([
    Input()
], DeviceSoftwareChangesComponent.prototype, "changes", void 0);
tslib_1.__decorate([
    Input()
], DeviceSoftwareChangesComponent.prototype, "changesInProgress", void 0);
tslib_1.__decorate([
    Output()
], DeviceSoftwareChangesComponent.prototype, "clear", void 0);
tslib_1.__decorate([
    Output()
], DeviceSoftwareChangesComponent.prototype, "apply", void 0);
DeviceSoftwareChangesComponent = tslib_1.__decorate([
    Component({
        selector: 'c8y-device-software-changes',
        template: "<div class=\"card\">\n  <div class=\"card-header separator\">\n    <h4 class=\"card-title\" translate>Software changes</h4>\n  </div>\n\n  <div class=\"card-block\" *ngIf=\"(changes$ | async).length === 0; else changesList\">\n    <div class=\"c8y-empty-state text-center\">\n      <h1 class=\"c8y-icon c8y-icon-device-control c8y-icon-duocolor\"></h1>\n      <p>\n        <strong translate>No software changes.</strong> <br />\n        <small translate>Selected actions will be displayed here.</small>\n      </p>\n    </div>\n  </div>\n\n  <ng-template #changesList>\n    <fieldset *ngIf=\"(installations$ | async).length > 0\">\n      <div class=\"p-l-16 p-r-16\">\n        <div class=\"form-block legend\" translate>Installations`software`</div>\n      </div>\n      <c8y-device-software-list [softwareList]=\"installations$ | async\"></c8y-device-software-list>\n    </fieldset>\n\n    <fieldset *ngIf=\"(updates$ | async).length > 0\">\n      <div class=\"p-l-16 p-r-16\">\n        <div class=\"form-block legend\" translate>Updates`software,noun`</div>\n      </div>\n      <c8y-device-software-list [softwareList]=\"updates$ | async\"></c8y-device-software-list>\n    </fieldset>\n\n    <fieldset *ngIf=\"(removals$ | async).length > 0\">\n      <div class=\"p-l-16 p-r-16\">\n        <div class=\"form-block legend\" translate>Removals`software`</div>\n      </div>\n      <c8y-device-software-list [softwareList]=\"removals$ | async\"></c8y-device-software-list>\n    </fieldset>\n  </ng-template>\n\n  <div class=\"card-footer p-b-8\" *ngIf=\"(changes$ | async).length > 0\">\n    <div class=\"content-flex-27\">\n      <button\n        class=\"btn btn-default col-6 m-b-8\"\n        (click)=\"clear.emit()\"\n        title=\"{{ 'Clear changes' | translate }}\"\n        [disabled]=\"changesInProgress\"\n        translate\n      >\n        Clear changes\n      </button>\n      <button\n        class=\"btn btn-primary col-6 btn-block m-b-8\"\n        [ngClass]=\"{ 'btn-pending': changesInProgress }\"\n        [disabled]=\"changesInProgress\"\n        (click)=\"apply.emit()\"\n        title=\"{{ 'Apply changes' | translate }}\"\n        translate\n      >\n        Apply changes\n      </button>\n    </div>\n  </div>\n</div>\n"
    })
], DeviceSoftwareChangesComponent);
export { DeviceSoftwareChangesComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGV2aWNlLXNvZnR3YXJlLWNoYW5nZXMuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGM4eS9uZ3gtY29tcG9uZW50cy9yZXBvc2l0b3J5LyIsInNvdXJjZXMiOlsic29mdHdhcmUtZGV2aWNlLXRhYi9kZXZpY2Utc29mdHdhcmUtY2hhbmdlcy5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSxFQUFFLEtBQUssRUFBRSxZQUFZLEVBQTRCLE1BQU0sZUFBZSxDQUFDO0FBQ2pHLE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDdkMsT0FBTyxFQUFFLEdBQUcsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQ3JDLE9BQU8sRUFBRSxNQUFNLEVBQUUsTUFBTSxXQUFXLENBQUM7QUFRbkMsSUFBYSw4QkFBOEIsR0FBM0MsTUFBYSw4QkFBOEI7SUFKM0M7UUFPWSxVQUFLLEdBQXVCLElBQUksWUFBWSxFQUFFLENBQUM7UUFDL0MsVUFBSyxHQUF1QixJQUFJLFlBQVksRUFBRSxDQUFDO1FBRXpELGFBQVEsR0FBRyxJQUFJLGVBQWUsQ0FBeUIsRUFBRSxDQUFDLENBQUM7UUFDM0QsbUJBQWMsR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLElBQUksQ0FDakMsR0FBRyxDQUFDLE9BQU8sQ0FBQyxFQUFFO1lBQ1osT0FBTyxNQUFNLENBQUMsT0FBTyxFQUFFLE1BQU0sQ0FBQyxFQUFFO2dCQUM5QixNQUFNLEVBQUUsSUFBSSxFQUFFLE1BQU0sRUFBRSxHQUFHLE1BQU0sQ0FBQztnQkFDaEMsTUFBTSxjQUFjLEdBQUcsTUFBTSxDQUFDLE9BQU8sRUFBRSxFQUFFLElBQUksRUFBRSxDQUFDLENBQUM7Z0JBQ2pELE9BQU8sTUFBTSxLQUFLLFNBQVMsSUFBSSxjQUFjLENBQUMsTUFBTSxLQUFLLENBQUMsQ0FBQztZQUM3RCxDQUFDLENBQUMsQ0FBQztRQUNMLENBQUMsQ0FBQyxDQUNILENBQUM7UUFDRixhQUFRLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQzNCLEdBQUcsQ0FBQyxPQUFPLENBQUMsRUFBRTtZQUNaLE9BQU8sTUFBTSxDQUFDLE9BQU8sRUFBRSxNQUFNLENBQUMsRUFBRTtnQkFDOUIsTUFBTSxFQUFFLElBQUksRUFBRSxNQUFNLEVBQUUsR0FBRyxNQUFNLENBQUM7Z0JBQ2hDLE1BQU0sY0FBYyxHQUFHLE1BQU0sQ0FBQyxPQUFPLEVBQUUsRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFDO2dCQUNqRCxPQUFPLE1BQU0sS0FBSyxTQUFTLElBQUksY0FBYyxDQUFDLE1BQU0sS0FBSyxDQUFDLENBQUM7WUFDN0QsQ0FBQyxDQUFDLENBQUM7UUFDTCxDQUFDLENBQUMsQ0FDSCxDQUFDO1FBQ0YsY0FBUyxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUM1QixHQUFHLENBQUMsT0FBTyxDQUFDLEVBQUU7WUFDWixPQUFPLE1BQU0sQ0FBQyxPQUFPLEVBQUUsTUFBTSxDQUFDLEVBQUU7Z0JBQzlCLE1BQU0sRUFBRSxJQUFJLEVBQUUsTUFBTSxFQUFFLEdBQUcsTUFBTSxDQUFDO2dCQUNoQyxNQUFNLGNBQWMsR0FBRyxNQUFNLENBQUMsT0FBTyxFQUFFLEVBQUUsSUFBSSxFQUFFLENBQUMsQ0FBQztnQkFDakQsT0FBTyxNQUFNLEtBQUssUUFBUSxJQUFJLGNBQWMsQ0FBQyxNQUFNLEtBQUssQ0FBQyxDQUFDO1lBQzVELENBQUMsQ0FBQyxDQUFDO1FBQ0wsQ0FBQyxDQUFDLENBQ0gsQ0FBQztJQU9KLENBQUM7SUFMQyxXQUFXLENBQUMsT0FBc0I7UUFDaEMsSUFBSSxPQUFPLENBQUMsT0FBTyxFQUFFO1lBQ25CLElBQUksQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsWUFBWSxDQUFDLENBQUM7U0FDbEQ7SUFDSCxDQUFDO0NBQ0YsQ0FBQTtBQXZDVTtJQUFSLEtBQUssRUFBRTsrREFBaUM7QUFDaEM7SUFBUixLQUFLLEVBQUU7eUVBQTRCO0FBQzFCO0lBQVQsTUFBTSxFQUFFOzZEQUFnRDtBQUMvQztJQUFULE1BQU0sRUFBRTs2REFBZ0Q7QUFKOUMsOEJBQThCO0lBSjFDLFNBQVMsQ0FBQztRQUNULFFBQVEsRUFBRSw2QkFBNkI7UUFDdkMsK3NFQUFxRDtLQUN0RCxDQUFDO0dBQ1csOEJBQThCLENBd0MxQztTQXhDWSw4QkFBOEIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIE91dHB1dCwgSW5wdXQsIEV2ZW50RW1pdHRlciwgT25DaGFuZ2VzLCBTaW1wbGVDaGFuZ2VzIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBCZWhhdmlvclN1YmplY3QgfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IG1hcCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcbmltcG9ydCB7IGZpbHRlciB9IGZyb20gJ2xvZGFzaC1lcyc7XG5pbXBvcnQgeyBPcGVyYXRpb25TdGF0dXMgfSBmcm9tICdAYzh5L2NsaWVudCc7XG5pbXBvcnQgeyBEZXZpY2VTb2Z0d2FyZUNoYW5nZSB9IGZyb20gJy4uL3JlcG9zaXRvcnkubW9kZWwnO1xuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdjOHktZGV2aWNlLXNvZnR3YXJlLWNoYW5nZXMnLFxuICB0ZW1wbGF0ZVVybDogJ2RldmljZS1zb2Z0d2FyZS1jaGFuZ2VzLmNvbXBvbmVudC5odG1sJ1xufSlcbmV4cG9ydCBjbGFzcyBEZXZpY2VTb2Z0d2FyZUNoYW5nZXNDb21wb25lbnQgaW1wbGVtZW50cyBPbkNoYW5nZXMge1xuICBASW5wdXQoKSBjaGFuZ2VzOiBEZXZpY2VTb2Z0d2FyZUNoYW5nZVtdO1xuICBASW5wdXQoKSBjaGFuZ2VzSW5Qcm9ncmVzczogYm9vbGVhbjtcbiAgQE91dHB1dCgpIGNsZWFyOiBFdmVudEVtaXR0ZXI8dm9pZD4gPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG4gIEBPdXRwdXQoKSBhcHBseTogRXZlbnRFbWl0dGVyPHZvaWQ+ID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuXG4gIGNoYW5nZXMkID0gbmV3IEJlaGF2aW9yU3ViamVjdDxEZXZpY2VTb2Z0d2FyZUNoYW5nZVtdPihbXSk7XG4gIGluc3RhbGxhdGlvbnMkID0gdGhpcy5jaGFuZ2VzJC5waXBlKFxuICAgIG1hcChjaGFuZ2VzID0+IHtcbiAgICAgIHJldHVybiBmaWx0ZXIoY2hhbmdlcywgY2hhbmdlID0+IHtcbiAgICAgICAgY29uc3QgeyBuYW1lLCBhY3Rpb24gfSA9IGNoYW5nZTtcbiAgICAgICAgY29uc3QgcmVsYXRlZENoYW5nZXMgPSBmaWx0ZXIoY2hhbmdlcywgeyBuYW1lIH0pO1xuICAgICAgICByZXR1cm4gYWN0aW9uID09PSAnaW5zdGFsbCcgJiYgcmVsYXRlZENoYW5nZXMubGVuZ3RoID09PSAxO1xuICAgICAgfSk7XG4gICAgfSlcbiAgKTtcbiAgdXBkYXRlcyQgPSB0aGlzLmNoYW5nZXMkLnBpcGUoXG4gICAgbWFwKGNoYW5nZXMgPT4ge1xuICAgICAgcmV0dXJuIGZpbHRlcihjaGFuZ2VzLCBjaGFuZ2UgPT4ge1xuICAgICAgICBjb25zdCB7IG5hbWUsIGFjdGlvbiB9ID0gY2hhbmdlO1xuICAgICAgICBjb25zdCByZWxhdGVkQ2hhbmdlcyA9IGZpbHRlcihjaGFuZ2VzLCB7IG5hbWUgfSk7XG4gICAgICAgIHJldHVybiBhY3Rpb24gPT09ICdpbnN0YWxsJyAmJiByZWxhdGVkQ2hhbmdlcy5sZW5ndGggPT09IDI7XG4gICAgICB9KTtcbiAgICB9KVxuICApO1xuICByZW1vdmFscyQgPSB0aGlzLmNoYW5nZXMkLnBpcGUoXG4gICAgbWFwKGNoYW5nZXMgPT4ge1xuICAgICAgcmV0dXJuIGZpbHRlcihjaGFuZ2VzLCBjaGFuZ2UgPT4ge1xuICAgICAgICBjb25zdCB7IG5hbWUsIGFjdGlvbiB9ID0gY2hhbmdlO1xuICAgICAgICBjb25zdCByZWxhdGVkQ2hhbmdlcyA9IGZpbHRlcihjaGFuZ2VzLCB7IG5hbWUgfSk7XG4gICAgICAgIHJldHVybiBhY3Rpb24gPT09ICdkZWxldGUnICYmIHJlbGF0ZWRDaGFuZ2VzLmxlbmd0aCA9PT0gMTtcbiAgICAgIH0pO1xuICAgIH0pXG4gICk7XG5cbiAgbmdPbkNoYW5nZXMoY2hhbmdlczogU2ltcGxlQ2hhbmdlcykge1xuICAgIGlmIChjaGFuZ2VzLmNoYW5nZXMpIHtcbiAgICAgIHRoaXMuY2hhbmdlcyQubmV4dChjaGFuZ2VzLmNoYW5nZXMuY3VycmVudFZhbHVlKTtcbiAgICB9XG4gIH1cbn1cbiJdfQ==